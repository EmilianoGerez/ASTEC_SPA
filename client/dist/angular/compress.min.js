function ClientCtrl(e,t,r,n){function a(t,r){e.search.query({id:null,number:t,lastName:r},function(e){o.clientList=e})}var i,o=this;o.clientModel={},o.clientSearch={},o.errorInfo={msg:null,data:null},o.successInfo={msg:null,data:null},o.create=function(t){var r=new e.api(o.clientModel);r.$save(function(e){angular.copy(i,o.clientModel),t.$setPristine(),t.$setUntouched(),o.errorInfo.msg=null,o.successInfo.msg="Cliente creado con exito",o.successInfo.data=e},function(e){o.successInfo.msg=null,o.errorInfo.msg=e.data})},o.search=function(){o.clientSearch.number?(o.searchWord=o.clientSearch.number,a(o.clientSearch.number,"null")):o.clientSearch.lastName&&(o.searchWord=o.clientSearch.lastName,a("null",o.clientSearch.lastName))},o.remove=function(e){var t=r.confirm("Quieres eliminar a "+e.firstName+" "+e.lastName+" ?");t&&e.$remove()},o.findOne=function(){e.api.get({id:n.id},function(e){o.clientModel=e})},o.update=function(e){o.clientModel.$update(function(t){e.$setPristine(),e.$setUntouched(),o.errorInfo.msg=null,o.successInfo.msg="Cliente editado con exito",o.successInfo.data=t},function(e){o.successInfo.msg=null,o.errorInfo.msg=e.data})}}function mainCtrl(e){var t=this,r=e.path();t.isHome="/"==r}function OrderCtrl(e,t,r,n,a){function i(e,r){t.search.query({id:null,number:e,lastName:r},function(e){l.clientList=e})}function o(t,r){e.search.query({id:null,number:t,lastName:r},function(e){l.orderList=e})}var l=this;l.orderModel={},l.orderSearch={},l.errorInfo={msg:null,data:null},l.successInfo={msg:null,data:null},l.solvedOpt=["No","Si"],l.orderStatus=["Cancelada","Asignada","Completada"],l.create=function(t){l.orderModel.client=l.clientData._id,l.orderModel.tech={id:"1",firstName:"Jesie",lastName:"Pinkman"};var r=new e.api(l.orderModel);r.$save(function(e){l.orderModel={},l.clientData=null,l.clientSearch={},l.clientList=null,t.$setPristine(),t.$setUntouched(),l.errorInfo.msg=null,l.successInfo.msg="Orden creada con exito",l.successInfo.data=e},function(e){l.successInfo.msg=null,l.errorInfo.msg=e.data})},l.searchClient=function(){l.clientSearch.number?(l.searchWord=l.clientSearch.number,i(l.clientSearch.number,"null")):l.clientSearch.lastName&&(l.searchWord=l.clientSearch.lastName,i("null",l.clientSearch.lastName))},l.searchOrder=function(){l.orderSearch.number?(l.searchWord=l.orderSearch.number,o(l.orderSearch.number,"null")):l.orderSearch.lastName&&(l.searchWord=l.orderSearch.lastName,o("null",l.orderSearch.lastName))},l.remove=function(e){var t=n.confirm("Quieres eliminar a "+e.firstName+" "+e.lastName+" ?");t&&e.$remove()},l.findOne=function(){e.api.get({id:a.id},function(e){l.orderModel=e})},l.update=function(e){l.orderModel.tech={id:"1",firstName:"Walter",lastName:"White"},l.orderModel.$update(function(t){e.$setPristine(),e.$setUntouched(),l.errorInfo.msg=null,l.successInfo.msg="Orden editada con Ã©xito",l.successInfo.data=t},function(e){l.successInfo.msg=null,l.errorInfo.msg=e.data})}}var appConfiguration=function(){var e="main",t=["ngResource","ui.router","angular-jwt","angular-storage","ngMessages"],r=function(t,r){angular.module(t,r||[]),angular.module(e).requires.push(t)};return{appName:e,appDependencies:t,registerModule:r}}();angular.module(appConfiguration.appName,appConfiguration.appDependencies),appConfiguration.registerModule("client"),appConfiguration.registerModule("order"),appConfiguration.registerModule("user"),angular.module("client").config(["$stateProvider",function(e){e.state("clientPanel",{url:"/clients",templateUrl:"modules/client/views/client-panel.client.view.html"}).state("editClient",{url:"/clients/:id/edit",templateUrl:"modules/client/views/edit-client.client.view.html"}).state("clientDetail",{url:"/clients/:id",templateUrl:"modules/client/views/client-detail.client.view.html",data:{requiresLogin:!0}})}]),angular.module("client").controller("ClientCtrl",["Clients","$http","$window","$stateParams",ClientCtrl]),angular.module("client").factory("Clients",["$resource",function(e){var t=e("api/clients/:id",{id:"@_id"},{update:{method:"PUT"}}),r=e("api/clients/:id/search/:number/:lastName",{id:"@_id",number:"number",lastName:"lastName"});return{api:t,search:r}}]),angular.module("main").config(["$stateProvider","$locationProvider","$urlRouterProvider","jwtInterceptorProvider","$httpProvider",function(e,t,r,n,a){r.otherwise("/"),n.tokenGetter=["jwtHelper","$http","store","$state","$rootScope",function(e,t,r,n,a){var i=r.get("jwt");try{return e.isTokenExpired(i)?t({url:"http://localhost:3000/api/users/refresh",skipAuthorization:!0,method:"POST",data:{token:i}}).then(function(e){var t=e.data.token;return r.set("jwt",t),t},function(e){return r.remove("jwt"),n.go("signin"),!1}):i}catch(o){return r.remove("jwt"),!1}}],a.interceptors.push("jwtInterceptor"),e.state("dashboard",{url:"/",templateUrl:"modules/main/views/dashboard.client.view.html"})}]),angular.module("main").controller("mainCtrl",["$location",mainCtrl]),angular.module("order").config(["$stateProvider",function(e){e.state("orderPanel",{url:"/orders",templateUrl:"modules/order/views/order-panel.client.view.html",data:{requiresLogin:!0}}).state("editorder",{url:"/orders/:id/edit",templateUrl:"modules/order/views/edit-order.client.view.html"}).state("orderDetail",{url:"/orders/:id",templateUrl:"modules/order/views/order-detail.client.view.html"})}]),angular.module("order").controller("OrderCtrl",["Orders","Clients","$http","$window","$stateParams",OrderCtrl]),angular.module("order").factory("Orders",["$resource",function(e){var t=e("api/orders/:id",{id:"@_id"},{update:{method:"PUT"}}),r=e("api/orders/:id/search/:number/:lastName",{id:"@_id",number:"number",lastName:"lastName"});return{api:t,search:r}}]),angular.module("user").config(["$stateProvider",function(e){e.state("signup",{url:"/signup",templateUrl:"modules/user/views/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/user/views/signin.client.view.html"}).state("secureview",{url:"/secureview",templateUrl:"modules/user/views/secureview.client.view.html",data:{requiresLogin:!0}})}]).run(["$rootScope","$window","store","jwtHelper",function(e,t,r,n){e.$on("$stateChangeStart",function(e,n){n.data&&n.data.requiresLogin&&(r.get("jwt")||(t.location.href="/signin"))})}]),angular.module("user").controller("UserController",["$window","Users","$http","store","jwtHelper",function(e,t,r,n,a){this.user={},this.signup=function(){r({url:"http://localhost:3000/api/users/signup",method:"POST",data:this.user}).then(function(t){n.set("jwt",t.data.token),e.location.href="/panel"},function(e){console.log(e),this.errMessage=e.data.message})},this.signin=function(){r({url:"http://localhost:3000/api/users/signin",method:"POST",data:this.user}).then(function(t){var r=t.data.token;n.set("jwt",r),e.location.href="/panel"},function(e){this.errMessage=e.data.message})},this.isAuth=function(){var e=n.get("jwt");return e?(this.payload=a.decodeToken(e),!0):!1},this.logout=function(){var e=n.get("jwt"),r=a.decodeToken(e);t.logout.get({id:r._id},function(){n.remove("jwt")})}}]),angular.module("user").directive("compareTo",[function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,t,r,n){n.$validators.compareTo=function(t){return t==e.otherModelValue},e.$watch("otherModelValue",function(){n.$validate()})}}}]),angular.module("user").directive("recordAvailabilityValidator",["$http","Users",function(e,t){return{require:"ngModel",link:function(e,r,n,a){function i(e){a.$setValidity("recordLoading",!e)}function o(e){a.$setValidity("recordAvailable",e)}a.$parsers.push(function(e){if(e&&0!==e.length){i(!0),o(!1);var r=t.search.get({name:e},function(){null===r.data&&(i(!1),o(!0))});return e}})}}}]),angular.module("user").factory("Users",["$resource",function(e){var t=e("api/users/logout/:id",{id:"@_id"}),r=e("api/users/search/:name",{name:"@name"});return{logout:t,search:r}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsaWVudC9jb250cm9sbGVycy9jbGllbnQuY2xpZW50LmNvbnRyb2xsZXIuanMiLCJtYWluL2NvbnRyb2xsZXJzL21haW4uY2xpZW50LmNvbnRyb2xsZXIuanMiLCJvcmRlci9jb250cm9sbGVycy9vcmRlci5jbGllbnQuY29udHJvbGxlci5qcyIsImNvbmZpZy1hcHAuanMiLCJtYWluLWFwcC5qcyIsImNsaWVudC9jbGllbnQuY2xpZW50LnJlZ2lzdGVyLmpzIiwib3JkZXIvb3JkZXIuY2xpZW50LnJlZ2lzdGVyLmpzIiwidXNlci91c2VyLmNsaWVudC5yZWdpc3Rlci5qcyIsImNsaWVudC9jb25maWcvY2xpZW50LmNsaWVudC5yb3V0ZXMuanMiLCJjbGllbnQvc2VydmljZXMvY2xpZW50LmNsaWVudC5zZXJ2aWNlLmpzIiwibWFpbi9jb25maWcvbWFpbi5jbGllbnQucm91dGVzLmpzIiwib3JkZXIvY29uZmlnL29yZGVyLmNsaWVudC5yb3V0ZXMuanMiLCJvcmRlci9zZXJ2aWNlcy9vcmRlci5jbGllbnQuc2VydmljZS5qcyIsInVzZXIvY29uZmlnL3VzZXIuY2xpZW50LnJvdXRlcy5qcyIsInVzZXIvY29udHJvbGxlcnMvdXNlci5jbGllbnQuY29udHJvbGxlci5qcyIsInVzZXIvc2VydmljZXMvdXNlci5jbGllbnQuc2VydmljZS5qcyJdLCJuYW1lcyI6WyJDbGllbnRDdHJsIiwiQ2xpZW50cyIsIiRodHRwIiwiJHdpbmRvdyIsIiRzdGF0ZVBhcmFtcyIsImdldENsaWVudCIsIm51bWJlciIsImxhc3ROYW1lIiwic2VhcmNoIiwicXVlcnkiLCJpZCIsInJlc3BvbnNlIiwidm0iLCJjbGllbnRMaXN0IiwibWFzdGVyTW9kZWwiLCJ0aGlzIiwiY2xpZW50TW9kZWwiLCJjbGllbnRTZWFyY2giLCJlcnJvckluZm8iLCJtc2ciLCJkYXRhIiwic3VjY2Vzc0luZm8iLCJjcmVhdGUiLCJmb3JtIiwibmV3Q2xpZW50IiwiYXBpIiwiJHNhdmUiLCJyZXMiLCJhbmd1bGFyIiwiY29weSIsIiRzZXRQcmlzdGluZSIsIiRzZXRVbnRvdWNoZWQiLCJlcnIiLCJzZWFyY2hXb3JkIiwicmVtb3ZlIiwiY2xpZW50IiwiY29uZmlybSIsImZpcnN0TmFtZSIsIiRyZW1vdmUiLCJmaW5kT25lIiwiZ2V0IiwidXBkYXRlIiwiJHVwZGF0ZSIsIm1haW5DdHJsIiwiJGxvY2F0aW9uIiwiY3VycmVudFBhdGgiLCJwYXRoIiwiaXNIb21lIiwiT3JkZXJDdHJsIiwiT3JkZXJzIiwiZ2V0Y2xpZW50IiwiZ2V0b3JkZXIiLCJvcmRlckxpc3QiLCJvcmRlck1vZGVsIiwib3JkZXJTZWFyY2giLCJzb2x2ZWRPcHQiLCJvcmRlclN0YXR1cyIsImNsaWVudERhdGEiLCJfaWQiLCJ0ZWNoIiwibmV3b3JkZXIiLCJzZWFyY2hDbGllbnQiLCJzZWFyY2hPcmRlciIsIm9yZGVyIiwiYXBwQ29uZmlndXJhdGlvbiIsImFwcE5hbWUiLCJhcHBEZXBlbmRlbmNpZXMiLCJyZWdpc3Rlck1vZHVsZSIsIm1vZHVsZU5hbWUiLCJtb2R1bGVEZXBlbmRlbmNpZXMiLCJtb2R1bGUiLCJyZXF1aXJlcyIsInB1c2giLCJjb25maWciLCIkc3RhdGVQcm92aWRlciIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJyZXF1aXJlc0xvZ2luIiwiY29udHJvbGxlciIsImZhY3RvcnkiLCIkcmVzb3VyY2UiLCJtZXRob2QiLCIkbG9jYXRpb25Qcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsImp3dEludGVyY2VwdG9yUHJvdmlkZXIiLCIkaHR0cFByb3ZpZGVyIiwib3RoZXJ3aXNlIiwidG9rZW5HZXR0ZXIiLCJqd3RIZWxwZXIiLCJzdG9yZSIsIiRzdGF0ZSIsIiRyb290U2NvcGUiLCJpZFRva2VuIiwiaXNUb2tlbkV4cGlyZWQiLCJza2lwQXV0aG9yaXphdGlvbiIsInRva2VuIiwidGhlbiIsImlkX3Rva2VuIiwic2V0IiwiZ28iLCJpbnRlcmNlcHRvcnMiLCJydW4iLCIkb24iLCJlIiwidG8iLCJsb2NhdGlvbiIsImhyZWYiLCJVc2VycyIsInVzZXIiLCJzaWdudXAiLCJjb25zb2xlIiwibG9nIiwiZXJyTWVzc2FnZSIsIm1lc3NhZ2UiLCJzaWduaW4iLCJpc0F1dGgiLCJwYXlsb2FkIiwiZGVjb2RlVG9rZW4iLCJsb2dvdXQiLCJkZWNvZGVkIiwiZGlyZWN0aXZlIiwicmVxdWlyZSIsInNjb3BlIiwib3RoZXJNb2RlbFZhbHVlIiwibGluayIsImVsZW1lbnQiLCJhdHRyaWJ1dGVzIiwibmdNb2RlbCIsIiR2YWxpZGF0b3JzIiwiY29tcGFyZVRvIiwibW9kZWxWYWx1ZSIsIiR3YXRjaCIsIiR2YWxpZGF0ZSIsImF0dHJzIiwic2V0QXNMb2FkaW5nIiwiYm9vbCIsIiRzZXRWYWxpZGl0eSIsInNldEFzQXZhaWxhYmxlIiwiJHBhcnNlcnMiLCJ2YWx1ZSIsImxlbmd0aCIsIm5hbWUiXSwibWFwcGluZ3MiOiJBQUFBLFFBQUFBLFlBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBaUZBLFFBQUFDLEdBQUFDLEVBQUFDLEdBQ0FOLEVBQUFPLE9BQUFDLE9BQ0FDLEdBQUEsS0FDQUosT0FBQUEsRUFDQUMsU0FBQUEsR0FDQSxTQUFBSSxHQUNBQyxFQUFBQyxXQUFBRixJQXRGQSxHQUVBRyxHQUZBRixFQUFBRyxJQUlBSCxHQUFBSSxlQUNBSixFQUFBSyxnQkFDQUwsRUFBQU0sV0FDQUMsSUFBQSxLQUNBQyxLQUFBLE1BRUFSLEVBQUFTLGFBQ0FGLElBQUEsS0FDQUMsS0FBQSxNQUdBUixFQUFBVSxPQUFBLFNBQUFDLEdBQ0EsR0FBQUMsR0FBQSxHQUFBdkIsR0FBQXdCLElBQUFiLEVBQUFJLFlBRUFRLEdBQUFFLE1BQUEsU0FBQUMsR0FFQUMsUUFBQUMsS0FBQWYsRUFBQUYsRUFBQUksYUFDQU8sRUFBQU8sZUFDQVAsRUFBQVEsZ0JBRUFuQixFQUFBTSxVQUFBQyxJQUFBLEtBQ0FQLEVBQUFTLFlBQUFGLElBQUEsMkJBQ0FQLEVBQUFTLFlBQUFELEtBQUFPLEdBQ0EsU0FBQUssR0FFQXBCLEVBQUFTLFlBQUFGLElB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UixFQUFBQyxpQkFHQUQsRUFBQVMsT0FBQSxrQkFBQSxXQUNBSixFQUFBSyxtQkFNQXpHLFFBQUEwQyxPQUFBLFFBQ0FtRCxVQUFBLCtCQUFBLFFBQUEsUUFBQSxTQUFBdkgsRUFBQTBHLEdBRUEsT0FDQWMsUUFBQSxVQUNBRyxLQUFBLFNBQUFGLEVBQUFHLEVBQUFRLEVBQUFOLEdBR0EsUUFBQU8sR0FBQUMsR0FDQVIsRUFBQVMsYUFBQSxpQkFBQUQsR0FHQSxRQUFBRSxHQUFBRixHQUNBUixFQUFBUyxhQUFBLGtCQUFBRCxHQUdBUixFQUFBVyxTQUFBbkUsS0FBQSxTQUFBb0UsR0FDQSxHQUFBQSxHQUFBLElBQUFBLEVBQUFDLE9BQUEsQ0FFQU4sR0FBQSxHQUNBRyxHQUFBLEVBR0EsSUFBQXRILEdBQUF3RixFQUFBcEcsT0FBQWdDLEtBQ0FzRyxLQUFBRixHQUNBLFdBQ0EsT0FBQXhILEVBQUFBLE9BQ0FtSCxHQUFBLEdBQ0FHLEdBQUEsS0FHQSxPQUFBRSxXQ3pHQWhILFFBQUEwQyxPQUFBLFFBQUFVLFFBQUEsU0FBQSxZQUFBLFNBQUFDLEdBRUEsR0FBQXNDLEdBQUF0QyxFQUFBLHdCQUNBdkUsR0FBQSxTQUdBRixFQUFBeUUsRUFBQSwwQkFDQTZELEtBQUEsU0FHQSxRQUNBdkIsT0FBQUEsRUFDQS9HLE9BQUFBIiwiZmlsZSI6ImNvbXByZXNzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIENsaWVudEN0cmwoQ2xpZW50cywgJGh0dHAsICR3aW5kb3csICRzdGF0ZVBhcmFtcykge1xyXG4gIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gIHZhciBtYXN0ZXJNb2RlbDtcclxuXHJcbiAgdm0uY2xpZW50TW9kZWwgPSB7fTtcclxuICB2bS5jbGllbnRTZWFyY2ggPSB7fTtcclxuICB2bS5lcnJvckluZm8gPSB7XHJcbiAgICBtc2c6IG51bGwsXHJcbiAgICBkYXRhOiBudWxsXHJcbiAgfTtcclxuICB2bS5zdWNjZXNzSW5mbyA9IHtcclxuICAgIG1zZzogbnVsbCxcclxuICAgIGRhdGE6IG51bGxcclxuICB9O1xyXG5cclxuICB2bS5jcmVhdGUgPSBmdW5jdGlvbihmb3JtKSB7XHJcbiAgICB2YXIgbmV3Q2xpZW50ID0gbmV3IENsaWVudHMuYXBpKHZtLmNsaWVudE1vZGVsKTtcclxuXHJcbiAgICBuZXdDbGllbnQuJHNhdmUoZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgIC8vcmVzZXQgZm9ybVxyXG4gICAgICBhbmd1bGFyLmNvcHkobWFzdGVyTW9kZWwsIHZtLmNsaWVudE1vZGVsKTtcclxuICAgICAgZm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgZm9ybS4kc2V0VW50b3VjaGVkKCk7XHJcbiAgICAgIC8vYWxlcnRcclxuICAgICAgdm0uZXJyb3JJbmZvLm1zZyA9IG51bGw7XHJcbiAgICAgIHZtLnN1Y2Nlc3NJbmZvLm1zZyA9ICdDbGllbnRlIGNyZWFkbyBjb24gZXhpdG8nO1xyXG4gICAgICB2bS5zdWNjZXNzSW5mby5kYXRhID0gcmVzO1xyXG4gICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgIC8vYWxlcnRcclxuICAgICAgdm0uc3VjY2Vzc0luZm8ubXNnID0gbnVsbDtcclxuICAgICAgdm0uZXJyb3JJbmZvLm1zZyA9IGVyci5kYXRhO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgdm0uc2VhcmNoID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZiAodm0uY2xpZW50U2VhcmNoLm51bWJlcikge1xyXG4gICAgICB2bS5zZWFyY2hXb3JkID0gdm0uY2xpZW50U2VhcmNoLm51bWJlcjtcclxuICAgICAgZ2V0Q2xpZW50KHZtLmNsaWVudFNlYXJjaC5udW1iZXIsICdudWxsJyk7XHJcbiAgICB9IGVsc2UgaWYgKHZtLmNsaWVudFNlYXJjaC5sYXN0TmFtZSkge1xyXG4gICAgICB2bS5zZWFyY2hXb3JkID0gdm0uY2xpZW50U2VhcmNoLmxhc3ROYW1lO1xyXG4gICAgICBnZXRDbGllbnQoJ251bGwnLCB2bS5jbGllbnRTZWFyY2gubGFzdE5hbWUpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHZtLnJlbW92ZSA9IGZ1bmN0aW9uKGNsaWVudCkge1xyXG4gICAgdmFyIGNvbmZpcm0gPSAkd2luZG93LmNvbmZpcm0oJ1F1aWVyZXMgZWxpbWluYXIgYSAnICsgY2xpZW50LmZpcnN0TmFtZSArICcgJyArIGNsaWVudC5sYXN0TmFtZSArICcgPycpO1xyXG5cclxuICAgIGlmIChjb25maXJtKSB7XHJcbiAgICAgIGNsaWVudC4kcmVtb3ZlKCk7XHJcbiAgICAgICAgLy8gdm0uY2xpZW50TGlzdCA9IHZtLmNsaWVudExpc3QuZmlsdGVyKGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAvLyAgIHJldHVybiBlLl9pZCAhPT0gY2xpZW50Ll9pZDtcclxuICAgICAgICAvLyB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICB2bS5maW5kT25lID0gZnVuY3Rpb24oKSB7XHJcbiAgICBDbGllbnRzLmFwaS5nZXQoe1xyXG4gICAgICBpZDogJHN0YXRlUGFyYW1zLmlkXHJcbiAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICB2bS5jbGllbnRNb2RlbCA9IHJlc3BvbnNlO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgdm0udXBkYXRlID0gZnVuY3Rpb24oZm9ybSl7XHJcbiAgICB2bS5jbGllbnRNb2RlbC4kdXBkYXRlKGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAvL3Jlc2V0IGZvcm1cclxuICAgICAgZm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgZm9ybS4kc2V0VW50b3VjaGVkKCk7XHJcbiAgICAgIC8vYWxlcnRcclxuICAgICAgdm0uZXJyb3JJbmZvLm1zZyA9IG51bGw7XHJcbiAgICAgIHZtLnN1Y2Nlc3NJbmZvLm1zZyA9ICdDbGllbnRlIGVkaXRhZG8gY29uIGV4aXRvJztcclxuICAgICAgdm0uc3VjY2Vzc0luZm8uZGF0YSA9IHJlcztcclxuICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAvL2FsZXJ0XHJcbiAgICAgIHZtLnN1Y2Nlc3NJbmZvLm1zZyA9IG51bGw7XHJcbiAgICAgIHZtLmVycm9ySW5mby5tc2cgPSBlcnIuZGF0YTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIC8vIGZ1bmN0b24gaGVscGVycyAocHJpdmF0ZSlcclxuICBmdW5jdGlvbiBnZXRDbGllbnQobnVtYmVyLCBsYXN0TmFtZSkge1xyXG4gICAgQ2xpZW50cy5zZWFyY2gucXVlcnkoe1xyXG4gICAgICAnaWQnOiBudWxsLFxyXG4gICAgICAnbnVtYmVyJzogbnVtYmVyLFxyXG4gICAgICAnbGFzdE5hbWUnOiBsYXN0TmFtZVxyXG4gICAgfSwgZnVuY3Rpb24ocmVzcG9uc2Upe1xyXG4gICAgICB2bS5jbGllbnRMaXN0ID0gcmVzcG9uc2U7XHJcbiAgICB9KTsgIFxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmFuZ3VsYXJcclxuICAubW9kdWxlKCdjbGllbnQnKVxyXG4gIC5jb250cm9sbGVyKCdDbGllbnRDdHJsJywgWydDbGllbnRzJywgJyRodHRwJywgJyR3aW5kb3cnLCAnJHN0YXRlUGFyYW1zJywgQ2xpZW50Q3RybF0pO1xyXG4vLyBhbmd1bGFyLm1vZHVsZSgndXNlcicpXHJcbi8vICAgLmRpcmVjdGl2ZSgncmVjb3JkQXZhaWxhYmlsaXR5VmFsaWRhdG9yJywgWyckaHR0cCcsICdVc2VycycsIGZ1bmN0aW9uKCRodHRwLCBVc2Vycykge1xyXG5cclxuLy8gICAgIHJldHVybiB7XHJcbi8vICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuLy8gICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7XHJcbi8vICAgICAgICAgLy92YXIgYXBpVXJsID0gYXR0cnMucmVjb3JkQXZhaWxhYmlsaXR5VmFsaWRhdG9yO1xyXG5cclxuLy8gICAgICAgICBmdW5jdGlvbiBzZXRBc0xvYWRpbmcoYm9vbCkge1xyXG4vLyAgICAgICAgICAgbmdNb2RlbC4kc2V0VmFsaWRpdHkoJ3JlY29yZExvYWRpbmcnLCAhYm9vbCk7XHJcbi8vICAgICAgICAgfVxyXG5cclxuLy8gICAgICAgICBmdW5jdGlvbiBzZXRBc0F2YWlsYWJsZShib29sKSB7XHJcbi8vICAgICAgICAgICBuZ01vZGVsLiRzZXRWYWxpZGl0eSgncmVjb3JkQXZhaWxhYmxlJywgYm9vbCk7XHJcbi8vICAgICAgICAgfVxyXG5cclxuLy8gICAgICAgICBuZ01vZGVsLiRwYXJzZXJzLnB1c2goZnVuY3Rpb24odmFsdWUpIHtcclxuLy8gICAgICAgICAgIGlmICghdmFsdWUgfHwgdmFsdWUubGVuZ3RoID09PSAwKSByZXR1cm47XHJcblxyXG4vLyAgICAgICAgICAgc2V0QXNMb2FkaW5nKHRydWUpO1xyXG4vLyAgICAgICAgICAgc2V0QXNBdmFpbGFibGUoZmFsc2UpO1xyXG5cclxuLy8gICAgICAgICAgIC8vIHVzaW5nIHJlc291cmNlXHJcbi8vICAgICAgICAgICB2YXIgZGF0YSA9IFVzZXJzLnNlYXJjaC5nZXQoe1xyXG4vLyAgICAgICAgICAgICBuYW1lOiB2YWx1ZVxyXG4vLyAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XHJcbi8vICAgICAgICAgICAgIGlmIChkYXRhLmRhdGEgPT09ICcnKSB7XHJcbi8vICAgICAgICAgICAgICAgc2V0QXNMb2FkaW5nKGZhbHNlKTtcclxuLy8gICAgICAgICAgICAgICBzZXRBc0F2YWlsYWJsZSh0cnVlKTtcclxuLy8gICAgICAgICAgICAgfVxyXG4vLyAgICAgICAgICAgfSk7XHJcbi8vICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbi8vICAgICAgICAgfSk7XHJcbi8vICAgICAgIH1cclxuLy8gICAgIH07XHJcbi8vICAgfV0pOyIsImZ1bmN0aW9uIG1haW5DdHJsKCRsb2NhdGlvbikge1xyXG5cdHZhciB2bSA9IHRoaXM7XHJcblxyXG5cdHZhciBjdXJyZW50UGF0aCA9ICRsb2NhdGlvbi5wYXRoKCk7XHJcblx0dm0uaXNIb21lID0gKGN1cnJlbnRQYXRoID09ICcvJykgPyB0cnVlIDogZmFsc2U7XHJcbn1cclxuXHJcbmFuZ3VsYXJcclxuXHQubW9kdWxlKCdtYWluJylcclxuXHQuY29udHJvbGxlcignbWFpbkN0cmwnLCBbJyRsb2NhdGlvbicsIG1haW5DdHJsXSk7IiwiZnVuY3Rpb24gT3JkZXJDdHJsKE9yZGVycywgQ2xpZW50cywgJGh0dHAsICR3aW5kb3csICRzdGF0ZVBhcmFtcykge1xyXG4gIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gIHZtLm9yZGVyTW9kZWwgPSB7fTtcclxuICB2bS5vcmRlclNlYXJjaCA9IHt9O1xyXG4gIHZtLmVycm9ySW5mbyA9IHtcclxuICAgIG1zZzogbnVsbCxcclxuICAgIGRhdGE6IG51bGxcclxuICB9O1xyXG4gIHZtLnN1Y2Nlc3NJbmZvID0ge1xyXG4gICAgbXNnOiBudWxsLFxyXG4gICAgZGF0YTogbnVsbFxyXG4gIH07XHJcbiAgdm0uc29sdmVkT3B0ID0gWydObycsICdTaSddO1xyXG4gIHZtLm9yZGVyU3RhdHVzID0gWydDYW5jZWxhZGEnLCAnQXNpZ25hZGEnLCAnQ29tcGxldGFkYSddO1xyXG5cclxuICB2bS5jcmVhdGUgPSBmdW5jdGlvbihmb3JtKSB7XHJcbiAgICAvLyBoYXJkY29kZSBhdHRyXHJcbiAgICB2bS5vcmRlck1vZGVsLmNsaWVudCA9IHZtLmNsaWVudERhdGEuX2lkO1xyXG4gICAgLy8gVE9ET1xyXG4gICAgdm0ub3JkZXJNb2RlbC50ZWNoID0ge1xyXG4gICAgICBpZDogJzEnLFxyXG4gICAgICBmaXJzdE5hbWU6ICdKZXNpZScsXHJcbiAgICAgIGxhc3ROYW1lOiAnUGlua21hbidcclxuICAgIH07XHJcblxyXG4gICAgdmFyIG5ld29yZGVyID0gbmV3IE9yZGVycy5hcGkodm0ub3JkZXJNb2RlbCk7XHJcblxyXG4gICAgbmV3b3JkZXIuJHNhdmUoZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgIC8vcmVzZXQgZm9ybVxyXG4gICAgICB2bS5vcmRlck1vZGVsID0ge307XHJcbiAgICAgIHZtLmNsaWVudERhdGEgPSBudWxsO1xyXG4gICAgICB2bS5jbGllbnRTZWFyY2ggPSB7fTtcclxuICAgICAgdm0uY2xpZW50TGlzdCA9IG51bGw7XHJcbiAgICAgIGZvcm0uJHNldFByaXN0aW5lKCk7XHJcbiAgICAgIGZvcm0uJHNldFVudG91Y2hlZCgpO1xyXG4gICAgICAvL2FsZXJ0XHJcbiAgICAgIHZtLmVycm9ySW5mby5tc2cgPSBudWxsO1xyXG4gICAgICB2bS5zdWNjZXNzSW5mby5tc2cgPSAnT3JkZW4gY3JlYWRhIGNvbiBleGl0byc7XHJcbiAgICAgIHZtLnN1Y2Nlc3NJbmZvLmRhdGEgPSByZXM7XHJcbiAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgLy9hbGVydFxyXG4gICAgICB2bS5zdWNjZXNzSW5mby5tc2cgPSBudWxsO1xyXG4gICAgICB2bS5lcnJvckluZm8ubXNnID0gZXJyLmRhdGE7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICB2bS5zZWFyY2hDbGllbnQgPSBmdW5jdGlvbigpIHtcclxuICAgIGlmICh2bS5jbGllbnRTZWFyY2gubnVtYmVyKSB7XHJcbiAgICAgIHZtLnNlYXJjaFdvcmQgPSB2bS5jbGllbnRTZWFyY2gubnVtYmVyO1xyXG4gICAgICBnZXRjbGllbnQodm0uY2xpZW50U2VhcmNoLm51bWJlciwgJ251bGwnKTtcclxuICAgIH0gZWxzZSBpZiAodm0uY2xpZW50U2VhcmNoLmxhc3ROYW1lKSB7XHJcbiAgICAgIHZtLnNlYXJjaFdvcmQgPSB2bS5jbGllbnRTZWFyY2gubGFzdE5hbWU7XHJcbiAgICAgIGdldGNsaWVudCgnbnVsbCcsIHZtLmNsaWVudFNlYXJjaC5sYXN0TmFtZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgdm0uc2VhcmNoT3JkZXIgPSBmdW5jdGlvbigpIHtcclxuICAgIGlmICh2bS5vcmRlclNlYXJjaC5udW1iZXIpIHtcclxuICAgICAgdm0uc2VhcmNoV29yZCA9IHZtLm9yZGVyU2VhcmNoLm51bWJlcjtcclxuICAgICAgZ2V0b3JkZXIodm0ub3JkZXJTZWFyY2gubnVtYmVyLCAnbnVsbCcpO1xyXG4gICAgfSBlbHNlIGlmICh2bS5vcmRlclNlYXJjaC5sYXN0TmFtZSkge1xyXG4gICAgICB2bS5zZWFyY2hXb3JkID0gdm0ub3JkZXJTZWFyY2gubGFzdE5hbWU7XHJcbiAgICAgIGdldG9yZGVyKCdudWxsJywgdm0ub3JkZXJTZWFyY2gubGFzdE5hbWUpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHZtLnJlbW92ZSA9IGZ1bmN0aW9uKG9yZGVyKSB7XHJcbiAgICB2YXIgY29uZmlybSA9ICR3aW5kb3cuY29uZmlybSgnUXVpZXJlcyBlbGltaW5hciBhICcgKyBvcmRlci5maXJzdE5hbWUgKyAnICcgKyBvcmRlci5sYXN0TmFtZSArICcgPycpO1xyXG5cclxuICAgIGlmIChjb25maXJtKSB7XHJcbiAgICAgIG9yZGVyLiRyZW1vdmUoKTtcclxuICAgICAgLy8gdm0ub3JkZXJMaXN0ID0gdm0ub3JkZXJMaXN0LmZpbHRlcihmdW5jdGlvbihlKSB7XHJcbiAgICAgIC8vICAgcmV0dXJuIGUuX2lkICE9PSBvcmRlci5faWQ7XHJcbiAgICAgIC8vIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHZtLmZpbmRPbmUgPSBmdW5jdGlvbigpIHtcclxuICAgIE9yZGVycy5hcGkuZ2V0KHtcclxuICAgICAgaWQ6ICRzdGF0ZVBhcmFtcy5pZFxyXG4gICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgdm0ub3JkZXJNb2RlbCA9IHJlc3BvbnNlO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgdm0udXBkYXRlID0gZnVuY3Rpb24oZm9ybSkge1xyXG4gICAgLy8gVE9ET1xyXG4gICAgdm0ub3JkZXJNb2RlbC50ZWNoID0ge1xyXG4gICAgICBpZDogJzEnLFxyXG4gICAgICBmaXJzdE5hbWU6ICdXYWx0ZXInLFxyXG4gICAgICBsYXN0TmFtZTogJ1doaXRlJ1xyXG4gICAgfTtcclxuXHJcbiAgICB2bS5vcmRlck1vZGVsLiR1cGRhdGUoZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgIC8vcmVzZXQgZm9ybVxyXG4gICAgICBmb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICBmb3JtLiRzZXRVbnRvdWNoZWQoKTtcclxuICAgICAgLy9hbGVydFxyXG4gICAgICB2bS5lcnJvckluZm8ubXNnID0gbnVsbDtcclxuICAgICAgdm0uc3VjY2Vzc0luZm8ubXNnID0gJ09yZGVuIGVkaXRhZGEgY29uIMOpeGl0byc7XHJcbiAgICAgIHZtLnN1Y2Nlc3NJbmZvLmRhdGEgPSByZXM7XHJcbiAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgLy9hbGVydFxyXG4gICAgICB2bS5zdWNjZXNzSW5mby5tc2cgPSBudWxsO1xyXG4gICAgICB2bS5lcnJvckluZm8ubXNnID0gZXJyLmRhdGE7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAvLyBmdW5jdG9uIGhlbHBlcnMgKHByaXZhdGUpXHJcbiAgZnVuY3Rpb24gZ2V0Y2xpZW50KG51bWJlciwgbGFzdE5hbWUpIHtcclxuICAgIENsaWVudHMuc2VhcmNoLnF1ZXJ5KHtcclxuICAgICAgJ2lkJzogbnVsbCxcclxuICAgICAgJ251bWJlcic6IG51bWJlcixcclxuICAgICAgJ2xhc3ROYW1lJzogbGFzdE5hbWVcclxuICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgIHZtLmNsaWVudExpc3QgPSByZXNwb25zZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0b3JkZXIobnVtYmVyLCBsYXN0TmFtZSkge1xyXG4gICAgT3JkZXJzLnNlYXJjaC5xdWVyeSh7XHJcbiAgICAgICdpZCc6IG51bGwsXHJcbiAgICAgICdudW1iZXInOiBudW1iZXIsXHJcbiAgICAgICdsYXN0TmFtZSc6IGxhc3ROYW1lXHJcbiAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICB2bS5vcmRlckxpc3QgPSByZXNwb25zZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmFuZ3VsYXJcclxuICAubW9kdWxlKCdvcmRlcicpXHJcbiAgLmNvbnRyb2xsZXIoJ09yZGVyQ3RybCcsIFsnT3JkZXJzJywgJ0NsaWVudHMnLCAnJGh0dHAnLCAnJHdpbmRvdycsICckc3RhdGVQYXJhbXMnLCBPcmRlckN0cmxdKTtcclxuLy8gYW5ndWxhci5tb2R1bGUoJ3VzZXInKVxyXG4vLyAgIC5kaXJlY3RpdmUoJ3JlY29yZEF2YWlsYWJpbGl0eVZhbGlkYXRvcicsIFsnJGh0dHAnLCAnVXNlcnMnLCBmdW5jdGlvbigkaHR0cCwgVXNlcnMpIHtcclxuXHJcbi8vICAgICByZXR1cm4ge1xyXG4vLyAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbi8vICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgbmdNb2RlbCkge1xyXG4vLyAgICAgICAgIC8vdmFyIGFwaVVybCA9IGF0dHJzLnJlY29yZEF2YWlsYWJpbGl0eVZhbGlkYXRvcjtcclxuXHJcbi8vICAgICAgICAgZnVuY3Rpb24gc2V0QXNMb2FkaW5nKGJvb2wpIHtcclxuLy8gICAgICAgICAgIG5nTW9kZWwuJHNldFZhbGlkaXR5KCdyZWNvcmRMb2FkaW5nJywgIWJvb2wpO1xyXG4vLyAgICAgICAgIH1cclxuXHJcbi8vICAgICAgICAgZnVuY3Rpb24gc2V0QXNBdmFpbGFibGUoYm9vbCkge1xyXG4vLyAgICAgICAgICAgbmdNb2RlbC4kc2V0VmFsaWRpdHkoJ3JlY29yZEF2YWlsYWJsZScsIGJvb2wpO1xyXG4vLyAgICAgICAgIH1cclxuXHJcbi8vICAgICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbHVlKSB7XHJcbi8vICAgICAgICAgICBpZiAoIXZhbHVlIHx8IHZhbHVlLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG5cclxuLy8gICAgICAgICAgIHNldEFzTG9hZGluZyh0cnVlKTtcclxuLy8gICAgICAgICAgIHNldEFzQXZhaWxhYmxlKGZhbHNlKTtcclxuXHJcbi8vICAgICAgICAgICAvLyB1c2luZyByZXNvdXJjZVxyXG4vLyAgICAgICAgICAgdmFyIGRhdGEgPSBVc2Vycy5zZWFyY2guZ2V0KHtcclxuLy8gICAgICAgICAgICAgbmFtZTogdmFsdWVcclxuLy8gICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xyXG4vLyAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhID09PSAnJykge1xyXG4vLyAgICAgICAgICAgICAgIHNldEFzTG9hZGluZyhmYWxzZSk7XHJcbi8vICAgICAgICAgICAgICAgc2V0QXNBdmFpbGFibGUodHJ1ZSk7XHJcbi8vICAgICAgICAgICAgIH1cclxuLy8gICAgICAgICAgIH0pO1xyXG4vLyAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4vLyAgICAgICAgIH0pO1xyXG4vLyAgICAgICB9XHJcbi8vICAgICB9O1xyXG4vLyAgIH1dKTsiLCJ2YXIgYXBwQ29uZmlndXJhdGlvbiA9IChmdW5jdGlvbigpIHtcclxuXHR2YXIgYXBwTmFtZSA9ICdtYWluJztcclxuXHR2YXIgYXBwRGVwZW5kZW5jaWVzID0gWyduZ1Jlc291cmNlJywgJ3VpLnJvdXRlcicsICdhbmd1bGFyLWp3dCcsICdhbmd1bGFyLXN0b3JhZ2UnLCAnbmdNZXNzYWdlcyddO1xyXG5cclxuXHQvL01ldGhvZCBmb3IgYWRkIG5ldyBtb2R1bGVzXHJcblx0dmFyIHJlZ2lzdGVyTW9kdWxlID0gZnVuY3Rpb24obW9kdWxlTmFtZSwgbW9kdWxlRGVwZW5kZW5jaWVzKSB7XHJcblx0XHQvLyBDcmVhdGUgbW9kdWxlXHJcblx0XHRhbmd1bGFyLm1vZHVsZShtb2R1bGVOYW1lLCBtb2R1bGVEZXBlbmRlbmNpZXMgfHwgW10pO1xyXG5cclxuXHRcdC8vIEFkZCB0aGUgbmV3IG1vZHVsZSB0byB0aGUgYW5ndWxhciBjb25maWcgZmlsZVxyXG5cdFx0YW5ndWxhci5tb2R1bGUoYXBwTmFtZSkucmVxdWlyZXMucHVzaChtb2R1bGVOYW1lKTtcclxuXHR9O1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0YXBwTmFtZTogYXBwTmFtZSxcclxuXHRcdGFwcERlcGVuZGVuY2llczogYXBwRGVwZW5kZW5jaWVzLFxyXG5cdFx0cmVnaXN0ZXJNb2R1bGU6IHJlZ2lzdGVyTW9kdWxlXHJcblx0fVxyXG59KSAoKTsiLCIvL0RlZmluZSBtYWluIG1vZHVsZVxyXG5hbmd1bGFyLm1vZHVsZShhcHBDb25maWd1cmF0aW9uLmFwcE5hbWUsIGFwcENvbmZpZ3VyYXRpb24uYXBwRGVwZW5kZW5jaWVzKTsiLCJhcHBDb25maWd1cmF0aW9uLnJlZ2lzdGVyTW9kdWxlKCdjbGllbnQnKTsiLCJhcHBDb25maWd1cmF0aW9uLnJlZ2lzdGVyTW9kdWxlKCdvcmRlcicpOyIsImFwcENvbmZpZ3VyYXRpb24ucmVnaXN0ZXJNb2R1bGUoJ3VzZXInKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2xpZW50JylcclxuICAuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcikge1xyXG5cclxuICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgIC5zdGF0ZSgnY2xpZW50UGFuZWwnLCB7XHJcbiAgICAgICAgdXJsOiAnL2NsaWVudHMnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9jbGllbnQvdmlld3MvY2xpZW50LXBhbmVsLmNsaWVudC52aWV3Lmh0bWwnXHJcbiAgICAgIH0pLnN0YXRlKCdlZGl0Q2xpZW50Jywge1xyXG4gICAgICAgIHVybDogJy9jbGllbnRzLzppZC9lZGl0JyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvY2xpZW50L3ZpZXdzL2VkaXQtY2xpZW50LmNsaWVudC52aWV3Lmh0bWwnLFxyXG4gICAgICB9KS5zdGF0ZSgnY2xpZW50RGV0YWlsJywge1xyXG4gICAgICAgIHVybDogJy9jbGllbnRzLzppZCcsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NsaWVudC92aWV3cy9jbGllbnQtZGV0YWlsLmNsaWVudC52aWV3Lmh0bWwnLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIHJlcXVpcmVzTG9naW46IHRydWVcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gIH1dKTsiLCIvL0FydGljbGVzIHNlcnZpY2UgdXNlZCBmb3IgY29tbXVuaWNhdGluZyB3aXRoIHRoZSBhcnRpY2xlcyBSRVNUIGVuZHBvaW50c1xyXG5hbmd1bGFyLm1vZHVsZSgnY2xpZW50JykuZmFjdG9yeSgnQ2xpZW50cycsIFsnJHJlc291cmNlJywgZnVuY3Rpb24oJHJlc291cmNlKSB7XHJcblxyXG5cdHZhciBhcGkgPSAkcmVzb3VyY2UoJ2FwaS9jbGllbnRzLzppZCcsIHtcclxuXHRcdGlkOiAnQF9pZCdcclxuXHR9LCB7XHJcblx0XHR1cGRhdGU6IHtcclxuXHRcdFx0bWV0aG9kOiAnUFVUJ1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHR2YXIgc2VhcmNoID0gJHJlc291cmNlKCdhcGkvY2xpZW50cy86aWQvc2VhcmNoLzpudW1iZXIvOmxhc3ROYW1lJywge1xyXG5cdFx0aWQ6ICdAX2lkJyxcclxuXHRcdG51bWJlcjogJ251bWJlcicsXHJcblx0XHRsYXN0TmFtZTogJ2xhc3ROYW1lJ1xyXG5cdH0pO1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0YXBpOiBhcGksXHJcblx0XHRzZWFyY2g6IHNlYXJjaFxyXG5cdH07XHJcbn1dKTsiLCJhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWluJylcclxuICAgIC5jb25maWcoWyckc3RhdGVQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLCAnand0SW50ZXJjZXB0b3JQcm92aWRlcicsICckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsIGp3dEludGVyY2VwdG9yUHJvdmlkZXIsICRodHRwUHJvdmlkZXIpIHtcclxuICAgICAgICAvLyBSZWRpcmVjdCB0byBob21lIHZpZXcgd2hlbiByb3V0ZSBub3QgZm91bmRcclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XHJcblxyXG4gICAgICAgIC8vIHVzZSB0aGUgSFRNTDUgSGlzdG9yeSBBUElcclxuICAgICAgICAvLyRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgLy8gZ2V0IHRva2VuIHRvIGxvY2FsIHN0b3JhZ2UgYW5kIHNldCBvbiB0aGUgaGVhZGVyc1xyXG4gICAgICAgIGp3dEludGVyY2VwdG9yUHJvdmlkZXIudG9rZW5HZXR0ZXIgPSBbJ2p3dEhlbHBlcicsICckaHR0cCcsICdzdG9yZScsICckc3RhdGUnLCAnJHJvb3RTY29wZScsIGZ1bmN0aW9uKGp3dEhlbHBlciwgJGh0dHAsIHN0b3JlLCAkc3RhdGUsICRyb290U2NvcGUpIHtcclxuICAgICAgICAgICAgdmFyIGlkVG9rZW4gPSBzdG9yZS5nZXQoJ2p3dCcpO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGp3dEhlbHBlci5pc1Rva2VuRXhwaXJlZChpZFRva2VuKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBwcm9taXNlIG9mIGEgSldUIGlkX3Rva2VuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS91c2Vycy9yZWZyZXNoJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBtYWtlcyBpdCBzbyB0aGF0IHRoaXMgcmVxdWVzdCBkb2Vzbid0IHNlbmQgdGhlIEpXVFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBza2lwQXV0aG9yaXphdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiBpZFRva2VuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZF90b2tlbiA9IHJlc3BvbnNlLmRhdGEudG9rZW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLnNldCgnand0JywgaWRfdG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRfdG9rZW47XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLnJlbW92ZSgnand0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc2lnbmluJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkVG9rZW47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUucmVtb3ZlKCdqd3QnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1dO1xyXG4gICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2p3dEludGVyY2VwdG9yJyk7XHJcblxyXG4gICAgICAgIC8vIEhvbWUgc3RhdGUgcm91dGluZ1xyXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnZGFzaGJvYXJkJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnLycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbWFpbi92aWV3cy9kYXNoYm9hcmQuY2xpZW50LnZpZXcuaHRtbCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XSk7IiwiYW5ndWxhci5tb2R1bGUoJ29yZGVyJylcclxuICAuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcikge1xyXG5cclxuICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgIC5zdGF0ZSgnb3JkZXJQYW5lbCcsIHtcclxuICAgICAgICB1cmw6ICcvb3JkZXJzJyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvb3JkZXIvdmlld3Mvb3JkZXItcGFuZWwuY2xpZW50LnZpZXcuaHRtbCcsXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgcmVxdWlyZXNMb2dpbjogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgICAgfSkuc3RhdGUoJ2VkaXRvcmRlcicsIHtcclxuICAgICAgICB1cmw6ICcvb3JkZXJzLzppZC9lZGl0JyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvb3JkZXIvdmlld3MvZWRpdC1vcmRlci5jbGllbnQudmlldy5odG1sJyxcclxuICAgICAgfSkuc3RhdGUoJ29yZGVyRGV0YWlsJywge1xyXG4gICAgICAgIHVybDogJy9vcmRlcnMvOmlkJyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvb3JkZXIvdmlld3Mvb3JkZXItZGV0YWlsLmNsaWVudC52aWV3Lmh0bWwnXHJcbiAgICAgIH0pO1xyXG4gIH1dKTsiLCIvL0FydGljbGVzIHNlcnZpY2UgdXNlZCBmb3IgY29tbXVuaWNhdGluZyB3aXRoIHRoZSBhcnRpY2xlcyBSRVNUIGVuZHBvaW50c1xyXG5hbmd1bGFyLm1vZHVsZSgnb3JkZXInKS5mYWN0b3J5KCdPcmRlcnMnLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xyXG5cclxuXHR2YXIgYXBpID0gJHJlc291cmNlKCdhcGkvb3JkZXJzLzppZCcsIHtcclxuXHRcdGlkOiAnQF9pZCdcclxuXHR9LCB7XHJcblx0XHR1cGRhdGU6IHtcclxuXHRcdFx0bWV0aG9kOiAnUFVUJ1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHR2YXIgc2VhcmNoID0gJHJlc291cmNlKCdhcGkvb3JkZXJzLzppZC9zZWFyY2gvOm51bWJlci86bGFzdE5hbWUnLCB7XHJcblx0XHRpZDogJ0BfaWQnLFxyXG5cdFx0bnVtYmVyOiAnbnVtYmVyJyxcclxuXHRcdGxhc3ROYW1lOiAnbGFzdE5hbWUnXHJcblx0fSk7XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRhcGk6IGFwaSxcclxuXHRcdHNlYXJjaDogc2VhcmNoXHJcblx0fTtcclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCd1c2VyJylcclxuICAuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcikge1xyXG5cclxuICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgIC5zdGF0ZSgnc2lnbnVwJywge1xyXG4gICAgICAgIHVybDogJy9zaWdudXAnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy91c2VyL3ZpZXdzL3NpZ251cC5jbGllbnQudmlldy5odG1sJ1xyXG4gICAgICB9KS5zdGF0ZSgnc2lnbmluJywge1xyXG4gICAgICAgIHVybDogJy9zaWduaW4nLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy91c2VyL3ZpZXdzL3NpZ25pbi5jbGllbnQudmlldy5odG1sJyxcclxuICAgICAgfSkuc3RhdGUoJ3NlY3VyZXZpZXcnLCB7XHJcbiAgICAgICAgdXJsOiAnL3NlY3VyZXZpZXcnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy91c2VyL3ZpZXdzL3NlY3VyZXZpZXcuY2xpZW50LnZpZXcuaHRtbCcsXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgcmVxdWlyZXNMb2dpbjogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgfV0pXHJcbiAgLnJ1bihbJyRyb290U2NvcGUnLCAnJHdpbmRvdycsICdzdG9yZScsICdqd3RIZWxwZXInLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkd2luZG93LCBzdG9yZSwgand0SGVscGVyKSB7XHJcbiAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihlLCB0bykge1xyXG4gICAgICBpZiAodG8uZGF0YSAmJiB0by5kYXRhLnJlcXVpcmVzTG9naW4pIHtcclxuICAgICAgICBpZiAoIXN0b3JlLmdldCgnand0JykpIHtcclxuICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvc2lnbmluJztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1dKTsiLCJhbmd1bGFyLm1vZHVsZSgndXNlcicpXHJcbiAgLmNvbnRyb2xsZXIoJ1VzZXJDb250cm9sbGVyJywgWyckd2luZG93JywgJ1VzZXJzJywgJyRodHRwJywgJ3N0b3JlJywgJ2p3dEhlbHBlcicsIGZ1bmN0aW9uKCR3aW5kb3csIFVzZXJzLCAkaHR0cCwgc3RvcmUsIGp3dEhlbHBlcikge1xyXG5cclxuICAgIHRoaXMudXNlciA9IHt9O1xyXG5cclxuICAgIHRoaXMuc2lnbnVwID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICRodHRwKHtcclxuICAgICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL3VzZXJzL3NpZ251cCcsXHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgZGF0YTogdGhpcy51c2VyXHJcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICBzdG9yZS5zZXQoJ2p3dCcsIHJlc3BvbnNlLmRhdGEudG9rZW4pO1xyXG4gICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvcGFuZWwnO1xyXG4gICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgIHRoaXMuZXJyTWVzc2FnZSA9IGVyci5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnNpZ25pbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAkaHR0cCh7XHJcbiAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS91c2Vycy9zaWduaW4nLFxyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGRhdGE6IHRoaXMudXNlclxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgdmFyIHRva2VuID0gcmVzcG9uc2UuZGF0YS50b2tlbjtcclxuICAgICAgICBzdG9yZS5zZXQoJ2p3dCcsIHRva2VuKTtcclxuICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3BhbmVsJztcclxuICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgdGhpcy5lcnJNZXNzYWdlID0gZXJyLmRhdGEubWVzc2FnZTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaXNBdXRoID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHZhciB0b2tlbiA9IHN0b3JlLmdldCgnand0Jyk7XHJcbiAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgIHRoaXMucGF5bG9hZCA9IGp3dEhlbHBlci5kZWNvZGVUb2tlbih0b2tlbik7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMubG9nb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHZhciB0b2tlbiA9IHN0b3JlLmdldCgnand0Jyk7XHJcbiAgICAgIHZhciBkZWNvZGVkID0gand0SGVscGVyLmRlY29kZVRva2VuKHRva2VuKTtcclxuICAgICAgVXNlcnMubG9nb3V0LmdldCh7XHJcbiAgICAgICAgaWQ6IGRlY29kZWQuX2lkXHJcbiAgICAgIH0sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHN0b3JlLnJlbW92ZSgnand0Jyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICB9XSk7XHJcblxyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3VzZXInKVxyXG4gIC5kaXJlY3RpdmUoXCJjb21wYXJlVG9cIiwgW2Z1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmVxdWlyZTogXCJuZ01vZGVsXCIsXHJcbiAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgb3RoZXJNb2RlbFZhbHVlOiBcIj1jb21wYXJlVG9cIlxyXG4gICAgICB9LFxyXG4gICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcywgbmdNb2RlbCkge1xyXG5cclxuICAgICAgICBuZ01vZGVsLiR2YWxpZGF0b3JzLmNvbXBhcmVUbyA9IGZ1bmN0aW9uKG1vZGVsVmFsdWUpIHtcclxuICAgICAgICAgIHJldHVybiBtb2RlbFZhbHVlID09IHNjb3BlLm90aGVyTW9kZWxWYWx1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzY29wZS4kd2F0Y2goXCJvdGhlck1vZGVsVmFsdWVcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1dKTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCd1c2VyJylcclxuICAuZGlyZWN0aXZlKCdyZWNvcmRBdmFpbGFiaWxpdHlWYWxpZGF0b3InLCBbJyRodHRwJywgJ1VzZXJzJywgZnVuY3Rpb24oJGh0dHAsIFVzZXJzKSB7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHtcclxuICAgICAgICAvL3ZhciBhcGlVcmwgPSBhdHRycy5yZWNvcmRBdmFpbGFiaWxpdHlWYWxpZGF0b3I7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldEFzTG9hZGluZyhib29sKSB7XHJcbiAgICAgICAgICBuZ01vZGVsLiRzZXRWYWxpZGl0eSgncmVjb3JkTG9hZGluZycsICFib29sKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldEFzQXZhaWxhYmxlKGJvb2wpIHtcclxuICAgICAgICAgIG5nTW9kZWwuJHNldFZhbGlkaXR5KCdyZWNvcmRBdmFpbGFibGUnLCBib29sKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG5nTW9kZWwuJHBhcnNlcnMucHVzaChmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZS5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcbiAgICAgICAgICBzZXRBc0xvYWRpbmcodHJ1ZSk7XHJcbiAgICAgICAgICBzZXRBc0F2YWlsYWJsZShmYWxzZSk7XHJcblxyXG4gICAgICAgICAgLy8gdXNpbmcgcmVzb3VyY2VcclxuICAgICAgICAgIHZhciBkYXRhID0gVXNlcnMuc2VhcmNoLmdldCh7XHJcbiAgICAgICAgICAgIG5hbWU6IHZhbHVlXHJcbiAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEuZGF0YSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgIHNldEFzTG9hZGluZyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgc2V0QXNBdmFpbGFibGUodHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1dKTsiLCIvL0FydGljbGVzIHNlcnZpY2UgdXNlZCBmb3IgY29tbXVuaWNhdGluZyB3aXRoIHRoZSBhcnRpY2xlcyBSRVNUIGVuZHBvaW50c1xyXG5hbmd1bGFyLm1vZHVsZSgndXNlcicpLmZhY3RvcnkoJ1VzZXJzJywgWyckcmVzb3VyY2UnLCBmdW5jdGlvbigkcmVzb3VyY2UpIHtcclxuXHJcbiAgICB2YXIgbG9nb3V0ID0gJHJlc291cmNlKCdhcGkvdXNlcnMvbG9nb3V0LzppZCcsIHtcclxuICAgICAgICBpZDogJ0BfaWQnXHJcbiAgICB9KTtcclxuXHJcbiAgICB2YXIgc2VhcmNoID0gJHJlc291cmNlKCdhcGkvdXNlcnMvc2VhcmNoLzpuYW1lJywge1xyXG4gICAgICAgIG5hbWU6ICdAbmFtZSdcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbG9nb3V0OiBsb2dvdXQsXHJcbiAgICAgICAgc2VhcmNoOiBzZWFyY2hcclxuICAgIH07XHJcbn1cclxuXSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
