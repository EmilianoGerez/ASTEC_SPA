function ClientCtrl(e,r,t,n){function i(r,t){e.search.query({id:null,number:r,lastName:t},function(e){o.clientList=e})}var a,o=this;o.clientModel={},o.clientSearch={},o.errorInfo={msg:null,data:null},o.successInfo={msg:null,data:null},o.create=function(r){var t=new e.api(o.clientModel);t.$save(function(e){angular.copy(a,o.clientModel),r.$setPristine(),r.$setUntouched(),o.errorInfo.msg=null,o.successInfo.msg="Cliente creado con exito",o.successInfo.data=e},function(e){o.successInfo.msg=null,o.errorInfo.msg=e.data})},o.search=function(){o.clientSearch.number?(o.searchWord=o.clientSearch.number,i(o.clientSearch.number,"null")):o.clientSearch.lastName&&(o.searchWord=o.clientSearch.lastName,i("null",o.clientSearch.lastName))},o.remove=function(e){var r=t.confirm("Quieres eliminar a "+e.firstName+" "+e.lastName+" ?");r&&e.$remove()},o.findOne=function(){e.api.get({id:n.id},function(e){o.clientModel=e})},o.update=function(e){o.clientModel.$update(function(r){e.$setPristine(),e.$setUntouched(),o.errorInfo.msg=null,o.successInfo.msg="Cliente editado con exito",o.successInfo.data=r},function(e){o.successInfo.msg=null,o.errorInfo.msg=e.data})}}function mainCtrl(e,r){var t=this;t.getOrders=function(){var n=e.currentUserData();r.api.query(function(e){t.orders=e.filter(function(e){return e.tech.id==n._id})})}}function OrderCtrl(e,r,t,n,i,a){function o(e,t){r.search.query({id:null,number:e,lastName:t},function(e){s.clientList=e})}function l(r,t){e.search.query({id:null,number:r,lastName:t},function(e){s.orderList=e})}var s=this;s.orderModel={},s.orderSearch={},s.errorInfo={msg:null,data:null},s.successInfo={msg:null,data:null},s.solvedOpt=["No","Si"],s.orderStatus=["Cancelada","Asignada","Completada"],s.selectedTech="",s.create=function(r){s.orderModel.client=s.clientData._id,s.orderModel.tech={id:s.selectedTech._id,firstName:s.selectedTech.firstName,lastName:s.selectedTech.lastName};var t=new e.api(s.orderModel);t.$save(function(e){s.orderModel={},s.clientData=null,s.clientSearch={},s.clientList=null,r.$setPristine(),r.$setUntouched(),s.errorInfo.msg=null,s.successInfo.msg="Orden creada con exito",s.successInfo.data=e},function(e){s.successInfo.msg=null,s.errorInfo.msg=e.data})},s.searchClient=function(){s.clientSearch.number?(s.searchWord=s.clientSearch.number,o(s.clientSearch.number,"null")):s.clientSearch.lastName&&(s.searchWord=s.clientSearch.lastName,o("null",s.clientSearch.lastName))},s.searchOrder=function(){s.orderSearch.number?(s.searchWord=s.orderSearch.number,l(s.orderSearch.number,"null")):s.orderSearch.lastName&&(s.searchWord=s.orderSearch.lastName,l("null",s.orderSearch.lastName))},s.remove=function(e){var r=i.confirm("Quieres eliminar a "+e.firstName+" "+e.lastName+" ?");r&&e.$remove()},s.findOne=function(r){e.api.get({id:a.id},function(e){s.orderModel=e,r&&(s.selectedTech=s.users.filter(function(e){return e._id===s.orderModel.tech.id}),s.selectedTech=s.selectedTech[0])})},s.update=function(e){s.orderModel.tech={id:s.selectedTech._id,firstName:s.selectedTech.firstName,lastName:s.selectedTech.lastName},s.orderModel.$update(function(r){e.$setPristine(),e.$setUntouched(),s.errorInfo.msg=null,s.successInfo.msg="Orden editada con Ã©xito",s.successInfo.data=r},function(e){s.successInfo.msg=null,s.errorInfo.msg=e.data})},s.getAllUsers=function(){t.api.query(function(e){s.users=e.filter(function(e){return"Tech"===e.role})})}}function dlKeyCode(){return{restrict:"A",link:function(e,r,t){r.bind("keypress",function(r){var n=r.which||r.keyCode;n==t.code&&e.$apply(function(){e.$eval(t.dlKeyCode,{$event:r})})})}}}function UserServ(e,r){this.currentUserData=function(){var t=e.get("jwt");if(t){var n=r.decodeToken(t);return n}return!1}}var appConfiguration=function(){var e="main",r=["ngResource","ui.router","angular-jwt","angular-storage","ngMessages"],t=function(r,t){angular.module(r,t||[]),angular.module(e).requires.push(r)};return{appName:e,appDependencies:r,registerModule:t}}();angular.module(appConfiguration.appName,appConfiguration.appDependencies),appConfiguration.registerModule("client"),appConfiguration.registerModule("order"),appConfiguration.registerModule("user"),angular.module("client").config(["$stateProvider",function(e){e.state("clientPanel",{url:"/clients",templateUrl:"modules/client/views/client-panel.client.view.html"}).state("editClient",{url:"/clients/:id/edit",templateUrl:"modules/client/views/edit-client.client.view.html"}).state("clientDetail",{url:"/clients/:id",templateUrl:"modules/client/views/client-detail.client.view.html",data:{requiresLogin:!0}})}]),angular.module("client").controller("ClientCtrl",["Clients","$http","$window","$stateParams",ClientCtrl]),angular.module("client").factory("Clients",["$resource",function(e){var r=e("api/clients/:id",{id:"@_id"},{update:{method:"PUT"}}),t=e("api/clients/:id/search/:number/:lastName",{id:"@_id",number:"number",lastName:"lastName"});return{api:r,search:t}}]),angular.module("main").config(["$stateProvider","$locationProvider","$urlRouterProvider","jwtInterceptorProvider","$httpProvider",function(e,r,t,n,i){t.otherwise("/"),n.tokenGetter=["jwtHelper","$http","store","$state","$rootScope",function(e,r,t,n,i){var a=t.get("jwt");try{return e.isTokenExpired(a)?r({url:"http://localhost:3000/api/users/refresh",skipAuthorization:!0,method:"POST",data:{token:a}}).then(function(e){var r=e.data.token;return t.set("jwt",r),r},function(e){return t.remove("jwt"),n.go("signin"),!1}):a}catch(o){return t.remove("jwt"),!1}}],i.interceptors.push("jwtInterceptor"),e.state("dashboard",{url:"/",templateUrl:"modules/main/views/dashboard.client.view.html"})}]),angular.module("main").directive("ngEnter",function(){return function(e,r,t){r.bind("keydown keypress",function(r){13===r.which&&(e.$apply(function(){e.$eval(t.ngEnter,{event:r})}),r.preventDefault())})}}),angular.module("main").controller("mainCtrl",["UserServ","Orders",mainCtrl]),angular.module("order").config(["$stateProvider",function(e){e.state("orderPanel",{url:"/orders",templateUrl:"modules/order/views/order-panel.client.view.html",data:{requiresLogin:!1}}).state("editorder",{url:"/orders/:id/edit",templateUrl:"modules/order/views/edit-order.client.view.html"}).state("orderDetail",{url:"/orders/:id",templateUrl:"modules/order/views/order-detail.client.view.html"})}]),angular.module("order").controller("OrderCtrl",["Orders","Clients","Users","$http","$window","$stateParams",OrderCtrl]),angular.module("order").directive("dlKeyCode",dlKeyCode),angular.module("order").factory("Orders",["$resource",function(e){var r=e("api/orders/:id",{id:"@_id"},{update:{method:"PUT"}}),t=e("api/orders/:id/search/:number/:lastName",{id:"@_id",number:"number",lastName:"lastName"});return{api:r,search:t}}]),angular.module("user").config(["$stateProvider",function(e){e.state("signup",{url:"/signup",templateUrl:"modules/user/views/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/user/views/signin.client.view.html"}).state("secureview",{url:"/secureview",templateUrl:"modules/user/views/secureview.client.view.html",data:{requiresLogin:!0}})}]).run(["$rootScope","$window","store","jwtHelper",function(e,r,t,n){e.$on("$stateChangeStart",function(e,n){n.data&&n.data.requiresLogin&&(t.get("jwt")||(r.location.href="/signin"))})}]),angular.module("user").controller("UserController",["$window","Users","$http","store","jwtHelper","$stateParams",function(e,r,t,n,i,a){var o=this;o.user={},o.errorInfo={},o.signup=function(){var t=new r.api(o.user);t.$save(function(r){n.set("jwt",r.token),e.location.href="/panel"},function(e){o.errorInfo=e})},o.signin=function(){t({url:"http://localhost:3000/api/users/signin",method:"POST",data:o.user}).then(function(r){var t=r.data.token;n.set("jwt",t),e.location.href="/panel"},function(e){o.errorInfo=e.data})},o.getAll=function(){r.api.query(function(e){o.users=e.filter(function(e){return"Tech"===e.role})})},o.getOne=function(){r.api.get({id:a.id},function(e){o.user=e})},o.logout=function(){var e=n.get("jwt"),t=i.decodeToken(e);r.logout.get({id:t._id},function(){n.remove("jwt")})}}]),angular.module("user").directive("compareTo",[function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,r,t,n){n.$validators.compareTo=function(r){return r==e.otherModelValue},e.$watch("otherModelValue",function(){n.$validate()})}}}]),angular.module("user").directive("recordAvailabilityValidator",["$http","Users",function(e,r){return{require:"ngModel",link:function(e,t,n,i){function a(e){i.$setValidity("recordLoading",!e)}function o(e){i.$setValidity("recordAvailable",e)}i.$parsers.push(function(e){if(e&&0!==e.length){a(!0),o(!1);var t=r.search.get({email:e},function(){null===t.data&&(a(!1),o(!0))});return e}})}}}]),angular.module("user").service("UserServ",["store","jwtHelper",UserServ]),angular.module("user").factory("Users",["$resource",function(e){var r=e("api/users/signup/:id",{id:"@_id"}),t=e("api/users/logout/:id",{id:"@_id"}),n=e("api/users/search/:email",{email:"@email"});return{api:r,logout:t,search:n}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsaWVudC9jb250cm9sbGVycy9jbGllbnQuY2xpZW50LmNvbnRyb2xsZXIuanMiLCJtYWluL2NvbnRyb2xsZXJzL21haW4uY2xpZW50LmNvbnRyb2xsZXIuanMiLCJvcmRlci9jb250cm9sbGVycy9vcmRlci5jbGllbnQuY29udHJvbGxlci5qcyIsIm9yZGVyL2RpcmVjdGl2ZXMvb3JkZXIuZGlyZWN0aXZlcy5qcyIsInVzZXIvc2VydmljZXMvdXNlci1zZXJ2LmNsaWVudC5zZXJ2aWNlLmpzIiwiY29uZmlnLWFwcC5qcyIsIm1haW4tYXBwLmpzIiwiY2xpZW50L2NsaWVudC5jbGllbnQucmVnaXN0ZXIuanMiLCJvcmRlci9vcmRlci5jbGllbnQucmVnaXN0ZXIuanMiLCJ1c2VyL3VzZXIuY2xpZW50LnJlZ2lzdGVyLmpzIiwiY2xpZW50L2NvbmZpZy9jbGllbnQuY2xpZW50LnJvdXRlcy5qcyIsImNsaWVudC9zZXJ2aWNlcy9jbGllbnQuY2xpZW50LnNlcnZpY2UuanMiLCJtYWluL2NvbmZpZy9tYWluLmNsaWVudC5yb3V0ZXMuanMiLCJtYWluL2RpcmVjdGl2ZXMvbmdFbnRlci5kaXJlY3RpdmUuanMiLCJvcmRlci9jb25maWcvb3JkZXIuY2xpZW50LnJvdXRlcy5qcyIsIm9yZGVyL3NlcnZpY2VzL29yZGVyLmNsaWVudC5zZXJ2aWNlLmpzIiwidXNlci9jb25maWcvdXNlci5jbGllbnQucm91dGVzLmpzIiwidXNlci9jb250cm9sbGVycy91c2VyLmNsaWVudC5jb250cm9sbGVyLmpzIiwidXNlci9zZXJ2aWNlcy91c2VyLmNsaWVudC5zZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIkNsaWVudEN0cmwiLCJDbGllbnRzIiwiJGh0dHAiLCIkd2luZG93IiwiJHN0YXRlUGFyYW1zIiwiZ2V0Q2xpZW50IiwibnVtYmVyIiwibGFzdE5hbWUiLCJzZWFyY2giLCJxdWVyeSIsImlkIiwicmVzcG9uc2UiLCJ2bSIsImNsaWVudExpc3QiLCJtYXN0ZXJNb2RlbCIsInRoaXMiLCJjbGllbnRNb2RlbCIsImNsaWVudFNlYXJjaCIsImVycm9ySW5mbyIsIm1zZyIsImRhdGEiLCJzdWNjZXNzSW5mbyIsImNyZWF0ZSIsImZvcm0iLCJuZXdDbGllbnQiLCJhcGkiLCIkc2F2ZSIsInJlcyIsImFuZ3VsYXIiLCJjb3B5IiwiJHNldFByaXN0aW5lIiwiJHNldFVudG91Y2hlZCIsImVyciIsInNlYXJjaFdvcmQiLCJyZW1vdmUiLCJjbGllbnQiLCJjb25maXJtIiwiZmlyc3ROYW1lIiwiJHJlbW92ZSIsImZpbmRPbmUiLCJnZXQiLCJ1cGRhdGUiLCIkdXBkYXRlIiwibWFpbkN0cmwiLCJVc2VyU2VydiIsIk9yZGVycyIsImdldE9yZGVycyIsInBheWxvYWQiLCJjdXJyZW50VXNlckRhdGEiLCJvcmRlcnMiLCJmaWx0ZXIiLCJlIiwidGVjaCIsIl9pZCIsIk9yZGVyQ3RybCIsIlVzZXJzIiwiZ2V0Y2xpZW50IiwiZ2V0b3JkZXIiLCJvcmRlckxpc3QiLCJvcmRlck1vZGVsIiwib3JkZXJTZWFyY2giLCJzb2x2ZWRPcHQiLCJvcmRlclN0YXR1cyIsInNlbGVjdGVkVGVjaCIsImNsaWVudERhdGEiLCJuZXdvcmRlciIsInNlYXJjaENsaWVudCIsInNlYXJjaE9yZGVyIiwib3JkZXIiLCJlZGl0IiwidXNlcnMiLCJnZXRBbGxVc2VycyIsInJvbGUiLCJkbEtleUNvZGUiLCJyZXN0cmljdCIsImxpbmsiLCIkc2NvcGUiLCIkZWxlbWVudCIsIiRhdHRycyIsImJpbmQiLCJldmVudCIsImtleUNvZGUiLCJ3aGljaCIsImNvZGUiLCIkYXBwbHkiLCIkZXZhbCIsIiRldmVudCIsInN0b3JlIiwiand0SGVscGVyIiwidG9rZW4iLCJkZWNvZGVUb2tlbiIsImFwcENvbmZpZ3VyYXRpb24iLCJhcHBOYW1lIiwiYXBwRGVwZW5kZW5jaWVzIiwicmVnaXN0ZXJNb2R1bGUiLCJtb2R1bGVOYW1lIiwibW9kdWxlRGVwZW5kZW5jaWVzIiwibW9kdWxlIiwicmVxdWlyZXMiLCJwdXNoIiwiY29uZmlnIiwiJHN0YXRlUHJvdmlkZXIiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwicmVxdWlyZXNMb2dpbiIsImNvbnRyb2xsZXIiLCJmYWN0b3J5IiwiJHJlc291cmNlIiwibWV0aG9kIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJqd3RJbnRlcmNlcHRvclByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsIm90aGVyd2lzZSIsInRva2VuR2V0dGVyIiwiJHN0YXRlIiwiJHJvb3RTY29wZSIsImlkVG9rZW4iLCJpc1Rva2VuRXhwaXJlZCIsInNraXBBdXRob3JpemF0aW9uIiwidGhlbiIsImlkX3Rva2VuIiwic2V0IiwiZ28iLCJpbnRlcmNlcHRvcnMiLCJkaXJlY3RpdmUiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsIm5nRW50ZXIiLCJwcmV2ZW50RGVmYXVsdCIsInJ1biIsIiRvbiIsInRvIiwibG9jYXRpb24iLCJocmVmIiwidXNlciIsInNpZ251cCIsIm5ld1VzZXIiLCJzaWduaW4iLCJnZXRBbGwiLCJnZXRPbmUiLCJsb2dvdXQiLCJkZWNvZGVkIiwicmVxdWlyZSIsIm90aGVyTW9kZWxWYWx1ZSIsImF0dHJpYnV0ZXMiLCJuZ01vZGVsIiwiJHZhbGlkYXRvcnMiLCJjb21wYXJlVG8iLCJtb2RlbFZhbHVlIiwiJHdhdGNoIiwiJHZhbGlkYXRlIiwic2V0QXNMb2FkaW5nIiwiYm9vbCIsIiRzZXRWYWxpZGl0eSIsInNldEFzQXZhaWxhYmxlIiwiJHBhcnNlcnMiLCJ2YWx1ZSIsImxlbmd0aCIsImVtYWlsIiwic2VydmljZSJdLCJtYXBwaW5ncyI6IkFBQUEsUUFBQUEsWUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FpRkEsUUFBQUMsR0FBQUMsRUFBQUMsR0FDQU4sRUFBQU8sT0FBQUMsT0FDQUMsR0FBQSxLQUNBSixPQUFBQSxFQUNBQyxTQUFBQSxHQUNBLFNBQUFJLEdBQ0FDLEVBQUFDLFdBQUFGLElBdEZBLEdBRUFHLEdBRkFGLEVBQUFHLElBSUFILEdBQUFJLGVB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RyxHQUFBLEVBR0EsSUFBQXpJLEdBQUFtQyxFQUFBL0MsT0FBQWdDLEtBQ0F5SCxNQUFBRixHQUNBLFdBQ0EsT0FBQTNJLEVBQUFBLE9BQ0FzSSxHQUFBLEdBQ0FHLEdBQUEsS0FHQSxPQUFBRSxXYjdHQW5JLFFBQ0FxRSxPQUFBLFFBQ0FpRSxRQUFBLFlBQUEsUUFBQSxZQUFBdEgsV2NkQWhCLFFBQUFxRSxPQUFBLFFBQUFVLFFBQUEsU0FBQSxZQUFBLFNBQUFDLEdBRUEsR0FBQW5GLEdBQUFtRixFQUFBLHdCQUNBbEcsR0FBQSxTQUdBcUksRUFBQW5DLEVBQUEsd0JBQ0FsRyxHQUFBLFNBR0FGLEVBQUFvRyxFQUFBLDJCQUNBcUQsTUFBQSxVQUdBLFFBQ0F4SSxJQUFBQSxFQUNBc0gsT0FBQUEsRUFDQXZJLE9BQUFBIiwiZmlsZSI6ImNvbXByZXNzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIENsaWVudEN0cmwoQ2xpZW50cywgJGh0dHAsICR3aW5kb3csICRzdGF0ZVBhcmFtcykge1xyXG4gIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gIHZhciBtYXN0ZXJNb2RlbDtcclxuXHJcbiAgdm0uY2xpZW50TW9kZWwgPSB7fTtcclxuICB2bS5jbGllbnRTZWFyY2ggPSB7fTtcclxuICB2bS5lcnJvckluZm8gPSB7XHJcbiAgICBtc2c6IG51bGwsXHJcbiAgICBkYXRhOiBudWxsXHJcbiAgfTtcclxuICB2bS5zdWNjZXNzSW5mbyA9IHtcclxuICAgIG1zZzogbnVsbCxcclxuICAgIGRhdGE6IG51bGxcclxuICB9O1xyXG5cclxuICB2bS5jcmVhdGUgPSBmdW5jdGlvbihmb3JtKSB7XHJcbiAgICB2YXIgbmV3Q2xpZW50ID0gbmV3IENsaWVudHMuYXBpKHZtLmNsaWVudE1vZGVsKTtcclxuXHJcbiAgICBuZXdDbGllbnQuJHNhdmUoZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgIC8vcmVzZXQgZm9ybVxyXG4gICAgICBhbmd1bGFyLmNvcHkobWFzdGVyTW9kZWwsIHZtLmNsaWVudE1vZGVsKTtcclxuICAgICAgZm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgZm9ybS4kc2V0VW50b3VjaGVkKCk7XHJcbiAgICAgIC8vYWxlcnRcclxuICAgICAgdm0uZXJyb3JJbmZvLm1zZyA9IG51bGw7XHJcbiAgICAgIHZtLnN1Y2Nlc3NJbmZvLm1zZyA9ICdDbGllbnRlIGNyZWFkbyBjb24gZXhpdG8nO1xyXG4gICAgICB2bS5zdWNjZXNzSW5mby5kYXRhID0gcmVzO1xyXG4gICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgIC8vYWxlcnRcclxuICAgICAgdm0uc3VjY2Vzc0luZm8ubXNnID0gbnVsbDtcclxuICAgICAgdm0uZXJyb3JJbmZvLm1zZyA9IGVyci5kYXRhO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgdm0uc2VhcmNoID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZiAodm0uY2xpZW50U2VhcmNoLm51bWJlcikge1xyXG4gICAgICB2bS5zZWFyY2hXb3JkID0gdm0uY2xpZW50U2VhcmNoLm51bWJlcjtcclxuICAgICAgZ2V0Q2xpZW50KHZtLmNsaWVudFNlYXJjaC5udW1iZXIsICdudWxsJyk7XHJcbiAgICB9IGVsc2UgaWYgKHZtLmNsaWVudFNlYXJjaC5sYXN0TmFtZSkge1xyXG4gICAgICB2bS5zZWFyY2hXb3JkID0gdm0uY2xpZW50U2VhcmNoLmxhc3ROYW1lO1xyXG4gICAgICBnZXRDbGllbnQoJ251bGwnLCB2bS5jbGllbnRTZWFyY2gubGFzdE5hbWUpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHZtLnJlbW92ZSA9IGZ1bmN0aW9uKGNsaWVudCkge1xyXG4gICAgdmFyIGNvbmZpcm0gPSAkd2luZG93LmNvbmZpcm0oJ1F1aWVyZXMgZWxpbWluYXIgYSAnICsgY2xpZW50LmZpcnN0TmFtZSArICcgJyArIGNsaWVudC5sYXN0TmFtZSArICcgPycpO1xyXG5cclxuICAgIGlmIChjb25maXJtKSB7XHJcbiAgICAgIGNsaWVudC4kcmVtb3ZlKCk7XHJcbiAgICAgICAgLy8gdm0uY2xpZW50TGlzdCA9IHZtLmNsaWVudExpc3QuZmlsdGVyKGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAvLyAgIHJldHVybiBlLl9pZCAhPT0gY2xpZW50Ll9pZDtcclxuICAgICAgICAvLyB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICB2bS5maW5kT25lID0gZnVuY3Rpb24oKSB7XHJcbiAgICBDbGllbnRzLmFwaS5nZXQoe1xyXG4gICAgICBpZDogJHN0YXRlUGFyYW1zLmlkXHJcbiAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICB2bS5jbGllbnRNb2RlbCA9IHJlc3BvbnNlO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgdm0udXBkYXRlID0gZnVuY3Rpb24oZm9ybSl7XHJcbiAgICB2bS5jbGllbnRNb2RlbC4kdXBkYXRlKGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAvL3Jlc2V0IGZvcm1cclxuICAgICAgZm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgZm9ybS4kc2V0VW50b3VjaGVkKCk7XHJcbiAgICAgIC8vYWxlcnRcclxuICAgICAgdm0uZXJyb3JJbmZvLm1zZyA9IG51bGw7XHJcbiAgICAgIHZtLnN1Y2Nlc3NJbmZvLm1zZyA9ICdDbGllbnRlIGVkaXRhZG8gY29uIGV4aXRvJztcclxuICAgICAgdm0uc3VjY2Vzc0luZm8uZGF0YSA9IHJlcztcclxuICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAvL2FsZXJ0XHJcbiAgICAgIHZtLnN1Y2Nlc3NJbmZvLm1zZyA9IG51bGw7XHJcbiAgICAgIHZtLmVycm9ySW5mby5tc2cgPSBlcnIuZGF0YTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIC8vIGZ1bmN0b24gaGVscGVycyAocHJpdmF0ZSlcclxuICBmdW5jdGlvbiBnZXRDbGllbnQobnVtYmVyLCBsYXN0TmFtZSkge1xyXG4gICAgQ2xpZW50cy5zZWFyY2gucXVlcnkoe1xyXG4gICAgICAnaWQnOiBudWxsLFxyXG4gICAgICAnbnVtYmVyJzogbnVtYmVyLFxyXG4gICAgICAnbGFzdE5hbWUnOiBsYXN0TmFtZVxyXG4gICAgfSwgZnVuY3Rpb24ocmVzcG9uc2Upe1xyXG4gICAgICB2bS5jbGllbnRMaXN0ID0gcmVzcG9uc2U7XHJcbiAgICB9KTsgIFxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmFuZ3VsYXJcclxuICAubW9kdWxlKCdjbGllbnQnKVxyXG4gIC5jb250cm9sbGVyKCdDbGllbnRDdHJsJywgWydDbGllbnRzJywgJyRodHRwJywgJyR3aW5kb3cnLCAnJHN0YXRlUGFyYW1zJywgQ2xpZW50Q3RybF0pO1xyXG4vLyBhbmd1bGFyLm1vZHVsZSgndXNlcicpXHJcbi8vICAgLmRpcmVjdGl2ZSgncmVjb3JkQXZhaWxhYmlsaXR5VmFsaWRhdG9yJywgWyckaHR0cCcsICdVc2VycycsIGZ1bmN0aW9uKCRodHRwLCBVc2Vycykge1xyXG5cclxuLy8gICAgIHJldHVybiB7XHJcbi8vICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuLy8gICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7XHJcbi8vICAgICAgICAgLy92YXIgYXBpVXJsID0gYXR0cnMucmVjb3JkQXZhaWxhYmlsaXR5VmFsaWRhdG9yO1xyXG5cclxuLy8gICAgICAgICBmdW5jdGlvbiBzZXRBc0xvYWRpbmcoYm9vbCkge1xyXG4vLyAgICAgICAgICAgbmdNb2RlbC4kc2V0VmFsaWRpdHkoJ3JlY29yZExvYWRpbmcnLCAhYm9vbCk7XHJcbi8vICAgICAgICAgfVxyXG5cclxuLy8gICAgICAgICBmdW5jdGlvbiBzZXRBc0F2YWlsYWJsZShib29sKSB7XHJcbi8vICAgICAgICAgICBuZ01vZGVsLiRzZXRWYWxpZGl0eSgncmVjb3JkQXZhaWxhYmxlJywgYm9vbCk7XHJcbi8vICAgICAgICAgfVxyXG5cclxuLy8gICAgICAgICBuZ01vZGVsLiRwYXJzZXJzLnB1c2goZnVuY3Rpb24odmFsdWUpIHtcclxuLy8gICAgICAgICAgIGlmICghdmFsdWUgfHwgdmFsdWUubGVuZ3RoID09PSAwKSByZXR1cm47XHJcblxyXG4vLyAgICAgICAgICAgc2V0QXNMb2FkaW5nKHRydWUpO1xyXG4vLyAgICAgICAgICAgc2V0QXNBdmFpbGFibGUoZmFsc2UpO1xyXG5cclxuLy8gICAgICAgICAgIC8vIHVzaW5nIHJlc291cmNlXHJcbi8vICAgICAgICAgICB2YXIgZGF0YSA9IFVzZXJzLnNlYXJjaC5nZXQoe1xyXG4vLyAgICAgICAgICAgICBuYW1lOiB2YWx1ZVxyXG4vLyAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XHJcbi8vICAgICAgICAgICAgIGlmIChkYXRhLmRhdGEgPT09ICcnKSB7XHJcbi8vICAgICAgICAgICAgICAgc2V0QXNMb2FkaW5nKGZhbHNlKTtcclxuLy8gICAgICAgICAgICAgICBzZXRBc0F2YWlsYWJsZSh0cnVlKTtcclxuLy8gICAgICAgICAgICAgfVxyXG4vLyAgICAgICAgICAgfSk7XHJcbi8vICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbi8vICAgICAgICAgfSk7XHJcbi8vICAgICAgIH1cclxuLy8gICAgIH07XHJcbi8vICAgfV0pOyIsImZ1bmN0aW9uIG1haW5DdHJsKFVzZXJTZXJ2LCBPcmRlcnMpIHtcclxuXHR2YXIgdm0gPSB0aGlzO1xyXG5cclxuXHR2bS5nZXRPcmRlcnMgPSBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBwYXlsb2FkID0gVXNlclNlcnYuY3VycmVudFVzZXJEYXRhKCk7XHJcblxyXG5cdFx0T3JkZXJzLmFwaS5xdWVyeShmdW5jdGlvbihyZXNwb25zZSkge1xyXG5cdFx0XHR2bS5vcmRlcnMgPSByZXNwb25zZS5maWx0ZXIoZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdHJldHVybiBlLnRlY2guaWQgPT0gcGF5bG9hZC5faWQ7XHJcblx0XHRcdH0pO1xyXG5cdFx0fSk7XHJcblx0fTtcclxuXHRcclxufVxyXG5cclxuYW5ndWxhclxyXG5cdC5tb2R1bGUoJ21haW4nKVxyXG5cdC5jb250cm9sbGVyKCdtYWluQ3RybCcsIFsnVXNlclNlcnYnLCAnT3JkZXJzJywgbWFpbkN0cmxdKTsiLCJmdW5jdGlvbiBPcmRlckN0cmwoT3JkZXJzLCBDbGllbnRzLCBVc2VycywgJGh0dHAsICR3aW5kb3csICRzdGF0ZVBhcmFtcykge1xyXG4gIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gIHZtLm9yZGVyTW9kZWwgPSB7fTtcclxuICB2bS5vcmRlclNlYXJjaCA9IHt9O1xyXG4gIHZtLmVycm9ySW5mbyA9IHtcclxuICAgIG1zZzogbnVsbCxcclxuICAgIGRhdGE6IG51bGxcclxuICB9O1xyXG4gIHZtLnN1Y2Nlc3NJbmZvID0ge1xyXG4gICAgbXNnOiBudWxsLFxyXG4gICAgZGF0YTogbnVsbFxyXG4gIH07XHJcbiAgdm0uc29sdmVkT3B0ID0gWydObycsICdTaSddO1xyXG4gIHZtLm9yZGVyU3RhdHVzID0gWydDYW5jZWxhZGEnLCAnQXNpZ25hZGEnLCAnQ29tcGxldGFkYSddO1xyXG4gIHZtLnNlbGVjdGVkVGVjaCA9ICcnO1xyXG5cclxuICB2bS5jcmVhdGUgPSBmdW5jdGlvbihmb3JtKSB7XHJcbiAgICAvLyBhc2luZyBhdHRyXHJcbiAgICB2bS5vcmRlck1vZGVsLmNsaWVudCA9IHZtLmNsaWVudERhdGEuX2lkO1xyXG4gICAgdm0ub3JkZXJNb2RlbC50ZWNoID0ge1xyXG4gICAgICBpZDogdm0uc2VsZWN0ZWRUZWNoLl9pZCxcclxuICAgICAgZmlyc3ROYW1lOiB2bS5zZWxlY3RlZFRlY2guZmlyc3ROYW1lLFxyXG4gICAgICBsYXN0TmFtZTogdm0uc2VsZWN0ZWRUZWNoLmxhc3ROYW1lXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBuZXdvcmRlciA9IG5ldyBPcmRlcnMuYXBpKHZtLm9yZGVyTW9kZWwpO1xyXG5cclxuICAgIG5ld29yZGVyLiRzYXZlKGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAvL3Jlc2V0IGZvcm1cclxuICAgICAgdm0ub3JkZXJNb2RlbCA9IHt9O1xyXG4gICAgICB2bS5jbGllbnREYXRhID0gbnVsbDtcclxuICAgICAgdm0uY2xpZW50U2VhcmNoID0ge307XHJcbiAgICAgIHZtLmNsaWVudExpc3QgPSBudWxsO1xyXG4gICAgICBmb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICBmb3JtLiRzZXRVbnRvdWNoZWQoKTtcclxuICAgICAgLy9hbGVydFxyXG4gICAgICB2bS5lcnJvckluZm8ubXNnID0gbnVsbDtcclxuICAgICAgdm0uc3VjY2Vzc0luZm8ubXNnID0gJ09yZGVuIGNyZWFkYSBjb24gZXhpdG8nO1xyXG4gICAgICB2bS5zdWNjZXNzSW5mby5kYXRhID0gcmVzO1xyXG4gICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgIC8vYWxlcnRcclxuICAgICAgdm0uc3VjY2Vzc0luZm8ubXNnID0gbnVsbDtcclxuICAgICAgdm0uZXJyb3JJbmZvLm1zZyA9IGVyci5kYXRhO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgdm0uc2VhcmNoQ2xpZW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZiAodm0uY2xpZW50U2VhcmNoLm51bWJlcikge1xyXG4gICAgICB2bS5zZWFyY2hXb3JkID0gdm0uY2xpZW50U2VhcmNoLm51bWJlcjtcclxuICAgICAgZ2V0Y2xpZW50KHZtLmNsaWVudFNlYXJjaC5udW1iZXIsICdudWxsJyk7XHJcbiAgICB9IGVsc2UgaWYgKHZtLmNsaWVudFNlYXJjaC5sYXN0TmFtZSkge1xyXG4gICAgICB2bS5zZWFyY2hXb3JkID0gdm0uY2xpZW50U2VhcmNoLmxhc3ROYW1lO1xyXG4gICAgICBnZXRjbGllbnQoJ251bGwnLCB2bS5jbGllbnRTZWFyY2gubGFzdE5hbWUpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHZtLnNlYXJjaE9yZGVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZiAodm0ub3JkZXJTZWFyY2gubnVtYmVyKSB7XHJcbiAgICAgIHZtLnNlYXJjaFdvcmQgPSB2bS5vcmRlclNlYXJjaC5udW1iZXI7XHJcbiAgICAgIGdldG9yZGVyKHZtLm9yZGVyU2VhcmNoLm51bWJlciwgJ251bGwnKTtcclxuICAgIH0gZWxzZSBpZiAodm0ub3JkZXJTZWFyY2gubGFzdE5hbWUpIHtcclxuICAgICAgdm0uc2VhcmNoV29yZCA9IHZtLm9yZGVyU2VhcmNoLmxhc3ROYW1lO1xyXG4gICAgICBnZXRvcmRlcignbnVsbCcsIHZtLm9yZGVyU2VhcmNoLmxhc3ROYW1lKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICB2bS5yZW1vdmUgPSBmdW5jdGlvbihvcmRlcikge1xyXG4gICAgdmFyIGNvbmZpcm0gPSAkd2luZG93LmNvbmZpcm0oJ1F1aWVyZXMgZWxpbWluYXIgYSAnICsgb3JkZXIuZmlyc3ROYW1lICsgJyAnICsgb3JkZXIubGFzdE5hbWUgKyAnID8nKTtcclxuXHJcbiAgICBpZiAoY29uZmlybSkge1xyXG4gICAgICBvcmRlci4kcmVtb3ZlKCk7XHJcbiAgICAgIC8vIHZtLm9yZGVyTGlzdCA9IHZtLm9yZGVyTGlzdC5maWx0ZXIoZnVuY3Rpb24oZSkge1xyXG4gICAgICAvLyAgIHJldHVybiBlLl9pZCAhPT0gb3JkZXIuX2lkO1xyXG4gICAgICAvLyB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICB2bS5maW5kT25lID0gZnVuY3Rpb24oZWRpdCkge1xyXG4gICAgT3JkZXJzLmFwaS5nZXQoe1xyXG4gICAgICBpZDogJHN0YXRlUGFyYW1zLmlkXHJcbiAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICB2bS5vcmRlck1vZGVsID0gcmVzcG9uc2U7XHJcbiAgICAgIC8vIHNldCB0ZWNoIGZvciBzZWxlY3QgaW4gZWRpdCBmb3JtXHJcbiAgICAgIGlmKGVkaXQpe1xyXG4gICAgICAgIHZtLnNlbGVjdGVkVGVjaCA9IHZtLnVzZXJzLmZpbHRlcihmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICByZXR1cm4gZS5faWQgPT09IHZtLm9yZGVyTW9kZWwudGVjaC5pZDtcclxuICAgICAgICB9KTtcclxuICAgICAgICB2bS5zZWxlY3RlZFRlY2ggPSB2bS5zZWxlY3RlZFRlY2hbMF07XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIHZtLnVwZGF0ZSA9IGZ1bmN0aW9uKGZvcm0pIHtcclxuICAgIHZtLm9yZGVyTW9kZWwudGVjaCA9IHtcclxuICAgICAgaWQ6IHZtLnNlbGVjdGVkVGVjaC5faWQsXHJcbiAgICAgIGZpcnN0TmFtZTogdm0uc2VsZWN0ZWRUZWNoLmZpcnN0TmFtZSxcclxuICAgICAgbGFzdE5hbWU6IHZtLnNlbGVjdGVkVGVjaC5sYXN0TmFtZVxyXG4gICAgfTtcclxuXHJcbiAgICB2bS5vcmRlck1vZGVsLiR1cGRhdGUoZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgIC8vcmVzZXQgZm9ybVxyXG4gICAgICBmb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICBmb3JtLiRzZXRVbnRvdWNoZWQoKTtcclxuICAgICAgLy9hbGVydFxyXG4gICAgICB2bS5lcnJvckluZm8ubXNnID0gbnVsbDtcclxuICAgICAgdm0uc3VjY2Vzc0luZm8ubXNnID0gJ09yZGVuIGVkaXRhZGEgY29uIMOpeGl0byc7XHJcbiAgICAgIHZtLnN1Y2Nlc3NJbmZvLmRhdGEgPSByZXM7XHJcbiAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgLy9hbGVydFxyXG4gICAgICB2bS5zdWNjZXNzSW5mby5tc2cgPSBudWxsO1xyXG4gICAgICB2bS5lcnJvckluZm8ubXNnID0gZXJyLmRhdGE7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICB2bS5nZXRBbGxVc2VycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgVXNlcnMuYXBpLnF1ZXJ5KGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgIHZtLnVzZXJzID0gcmVzcG9uc2UuZmlsdGVyKGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICByZXR1cm4gZS5yb2xlID09PSAnVGVjaCc7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgLy8gZnVuY3RvbiBoZWxwZXJzIChwcml2YXRlKVxyXG4gIGZ1bmN0aW9uIGdldGNsaWVudChudW1iZXIsIGxhc3ROYW1lKSB7XHJcbiAgICBDbGllbnRzLnNlYXJjaC5xdWVyeSh7XHJcbiAgICAgICdpZCc6IG51bGwsXHJcbiAgICAgICdudW1iZXInOiBudW1iZXIsXHJcbiAgICAgICdsYXN0TmFtZSc6IGxhc3ROYW1lXHJcbiAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICB2bS5jbGllbnRMaXN0ID0gcmVzcG9uc2U7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldG9yZGVyKG51bWJlciwgbGFzdE5hbWUpIHtcclxuICAgIE9yZGVycy5zZWFyY2gucXVlcnkoe1xyXG4gICAgICAnaWQnOiBudWxsLFxyXG4gICAgICAnbnVtYmVyJzogbnVtYmVyLFxyXG4gICAgICAnbGFzdE5hbWUnOiBsYXN0TmFtZVxyXG4gICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgdm0ub3JkZXJMaXN0ID0gcmVzcG9uc2U7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmFuZ3VsYXJcclxuICAubW9kdWxlKCdvcmRlcicpXHJcbiAgLmNvbnRyb2xsZXIoJ09yZGVyQ3RybCcsIFsnT3JkZXJzJywgJ0NsaWVudHMnLCAnVXNlcnMnLCAnJGh0dHAnLCAnJHdpbmRvdycsICckc3RhdGVQYXJhbXMnLCBPcmRlckN0cmxdKTtcclxuLy8gYW5ndWxhci5tb2R1bGUoJ3VzZXInKVxyXG4vLyAgIC5kaXJlY3RpdmUoJ3JlY29yZEF2YWlsYWJpbGl0eVZhbGlkYXRvcicsIFsnJGh0dHAnLCAnVXNlcnMnLCBmdW5jdGlvbigkaHR0cCwgVXNlcnMpIHtcclxuXHJcbi8vICAgICByZXR1cm4ge1xyXG4vLyAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbi8vICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgbmdNb2RlbCkge1xyXG4vLyAgICAgICAgIC8vdmFyIGFwaVVybCA9IGF0dHJzLnJlY29yZEF2YWlsYWJpbGl0eVZhbGlkYXRvcjtcclxuXHJcbi8vICAgICAgICAgZnVuY3Rpb24gc2V0QXNMb2FkaW5nKGJvb2wpIHtcclxuLy8gICAgICAgICAgIG5nTW9kZWwuJHNldFZhbGlkaXR5KCdyZWNvcmRMb2FkaW5nJywgIWJvb2wpO1xyXG4vLyAgICAgICAgIH1cclxuXHJcbi8vICAgICAgICAgZnVuY3Rpb24gc2V0QXNBdmFpbGFibGUoYm9vbCkge1xyXG4vLyAgICAgICAgICAgbmdNb2RlbC4kc2V0VmFsaWRpdHkoJ3JlY29yZEF2YWlsYWJsZScsIGJvb2wpO1xyXG4vLyAgICAgICAgIH1cclxuXHJcbi8vICAgICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbHVlKSB7XHJcbi8vICAgICAgICAgICBpZiAoIXZhbHVlIHx8IHZhbHVlLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG5cclxuLy8gICAgICAgICAgIHNldEFzTG9hZGluZyh0cnVlKTtcclxuLy8gICAgICAgICAgIHNldEFzQXZhaWxhYmxlKGZhbHNlKTtcclxuXHJcbi8vICAgICAgICAgICAvLyB1c2luZyByZXNvdXJjZVxyXG4vLyAgICAgICAgICAgdmFyIGRhdGEgPSBVc2Vycy5zZWFyY2guZ2V0KHtcclxuLy8gICAgICAgICAgICAgbmFtZTogdmFsdWVcclxuLy8gICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xyXG4vLyAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhID09PSAnJykge1xyXG4vLyAgICAgICAgICAgICAgIHNldEFzTG9hZGluZyhmYWxzZSk7XHJcbi8vICAgICAgICAgICAgICAgc2V0QXNBdmFpbGFibGUodHJ1ZSk7XHJcbi8vICAgICAgICAgICAgIH1cclxuLy8gICAgICAgICAgIH0pO1xyXG4vLyAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4vLyAgICAgICAgIH0pO1xyXG4vLyAgICAgICB9XHJcbi8vICAgICB9O1xyXG4vLyAgIH1dKTsiLCJhbmd1bGFyLm1vZHVsZShcIm9yZGVyXCIpLmRpcmVjdGl2ZSgnZGxLZXlDb2RlJywgZGxLZXlDb2RlKTtcclxuXHJcbmZ1bmN0aW9uIGRsS2V5Q29kZSgpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMpIHtcclxuICAgICAgICAgICAgJGVsZW1lbnQuYmluZChcImtleXByZXNzXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5Q29kZSA9IGV2ZW50LndoaWNoIHx8IGV2ZW50LmtleUNvZGU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGtleUNvZGUgPT0gJGF0dHJzLmNvZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGV2YWwoJGF0dHJzLmRsS2V5Q29kZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV2ZW50OiBldmVudFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0iLCJmdW5jdGlvbiBVc2VyU2VydihzdG9yZSwgand0SGVscGVyKSB7XHJcblxyXG5cdHRoaXMuY3VycmVudFVzZXJEYXRhID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHZhciB0b2tlbiA9IHN0b3JlLmdldCgnand0Jyk7XHJcbiAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgIHZhciBwYXlsb2FkID0gand0SGVscGVyLmRlY29kZVRva2VuKHRva2VuKTtcclxuICAgICAgICByZXR1cm4gcGF5bG9hZDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbn1cclxuXHJcbmFuZ3VsYXJcclxuLm1vZHVsZSgndXNlcicpXHJcbi5zZXJ2aWNlKCdVc2VyU2VydicsIFsnc3RvcmUnLCAnand0SGVscGVyJywgVXNlclNlcnZdKTsiLCJ2YXIgYXBwQ29uZmlndXJhdGlvbiA9IChmdW5jdGlvbigpIHtcclxuXHR2YXIgYXBwTmFtZSA9ICdtYWluJztcclxuXHR2YXIgYXBwRGVwZW5kZW5jaWVzID0gWyduZ1Jlc291cmNlJywgJ3VpLnJvdXRlcicsICdhbmd1bGFyLWp3dCcsICdhbmd1bGFyLXN0b3JhZ2UnLCAnbmdNZXNzYWdlcyddO1xyXG5cclxuXHQvL01ldGhvZCBmb3IgYWRkIG5ldyBtb2R1bGVzXHJcblx0dmFyIHJlZ2lzdGVyTW9kdWxlID0gZnVuY3Rpb24obW9kdWxlTmFtZSwgbW9kdWxlRGVwZW5kZW5jaWVzKSB7XHJcblx0XHQvLyBDcmVhdGUgbW9kdWxlXHJcblx0XHRhbmd1bGFyLm1vZHVsZShtb2R1bGVOYW1lLCBtb2R1bGVEZXBlbmRlbmNpZXMgfHwgW10pO1xyXG5cclxuXHRcdC8vIEFkZCB0aGUgbmV3IG1vZHVsZSB0byB0aGUgYW5ndWxhciBjb25maWcgZmlsZVxyXG5cdFx0YW5ndWxhci5tb2R1bGUoYXBwTmFtZSkucmVxdWlyZXMucHVzaChtb2R1bGVOYW1lKTtcclxuXHR9O1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0YXBwTmFtZTogYXBwTmFtZSxcclxuXHRcdGFwcERlcGVuZGVuY2llczogYXBwRGVwZW5kZW5jaWVzLFxyXG5cdFx0cmVnaXN0ZXJNb2R1bGU6IHJlZ2lzdGVyTW9kdWxlXHJcblx0fVxyXG59KSAoKTsiLCIvL0RlZmluZSBtYWluIG1vZHVsZVxyXG5hbmd1bGFyLm1vZHVsZShhcHBDb25maWd1cmF0aW9uLmFwcE5hbWUsIGFwcENvbmZpZ3VyYXRpb24uYXBwRGVwZW5kZW5jaWVzKTsiLCJhcHBDb25maWd1cmF0aW9uLnJlZ2lzdGVyTW9kdWxlKCdjbGllbnQnKTsiLCJhcHBDb25maWd1cmF0aW9uLnJlZ2lzdGVyTW9kdWxlKCdvcmRlcicpOyIsImFwcENvbmZpZ3VyYXRpb24ucmVnaXN0ZXJNb2R1bGUoJ3VzZXInKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2xpZW50JylcclxuICAuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcikge1xyXG5cclxuICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgIC5zdGF0ZSgnY2xpZW50UGFuZWwnLCB7XHJcbiAgICAgICAgdXJsOiAnL2NsaWVudHMnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9jbGllbnQvdmlld3MvY2xpZW50LXBhbmVsLmNsaWVudC52aWV3Lmh0bWwnXHJcbiAgICAgIH0pLnN0YXRlKCdlZGl0Q2xpZW50Jywge1xyXG4gICAgICAgIHVybDogJy9jbGllbnRzLzppZC9lZGl0JyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvY2xpZW50L3ZpZXdzL2VkaXQtY2xpZW50LmNsaWVudC52aWV3Lmh0bWwnLFxyXG4gICAgICB9KS5zdGF0ZSgnY2xpZW50RGV0YWlsJywge1xyXG4gICAgICAgIHVybDogJy9jbGllbnRzLzppZCcsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NsaWVudC92aWV3cy9jbGllbnQtZGV0YWlsLmNsaWVudC52aWV3Lmh0bWwnLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIHJlcXVpcmVzTG9naW46IHRydWVcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gIH1dKTsiLCIvL0FydGljbGVzIHNlcnZpY2UgdXNlZCBmb3IgY29tbXVuaWNhdGluZyB3aXRoIHRoZSBhcnRpY2xlcyBSRVNUIGVuZHBvaW50c1xyXG5hbmd1bGFyLm1vZHVsZSgnY2xpZW50JykuZmFjdG9yeSgnQ2xpZW50cycsIFsnJHJlc291cmNlJywgZnVuY3Rpb24oJHJlc291cmNlKSB7XHJcblxyXG5cdHZhciBhcGkgPSAkcmVzb3VyY2UoJ2FwaS9jbGllbnRzLzppZCcsIHtcclxuXHRcdGlkOiAnQF9pZCdcclxuXHR9LCB7XHJcblx0XHR1cGRhdGU6IHtcclxuXHRcdFx0bWV0aG9kOiAnUFVUJ1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHR2YXIgc2VhcmNoID0gJHJlc291cmNlKCdhcGkvY2xpZW50cy86aWQvc2VhcmNoLzpudW1iZXIvOmxhc3ROYW1lJywge1xyXG5cdFx0aWQ6ICdAX2lkJyxcclxuXHRcdG51bWJlcjogJ251bWJlcicsXHJcblx0XHRsYXN0TmFtZTogJ2xhc3ROYW1lJ1xyXG5cdH0pO1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0YXBpOiBhcGksXHJcblx0XHRzZWFyY2g6IHNlYXJjaFxyXG5cdH07XHJcbn1dKTsiLCJhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWluJylcclxuICAgIC5jb25maWcoWyckc3RhdGVQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLCAnand0SW50ZXJjZXB0b3JQcm92aWRlcicsICckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsIGp3dEludGVyY2VwdG9yUHJvdmlkZXIsICRodHRwUHJvdmlkZXIpIHtcclxuICAgICAgICAvLyBSZWRpcmVjdCB0byBob21lIHZpZXcgd2hlbiByb3V0ZSBub3QgZm91bmRcclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XHJcblxyXG4gICAgICAgIC8vIHVzZSB0aGUgSFRNTDUgSGlzdG9yeSBBUElcclxuICAgICAgICAvLyRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgLy8gZ2V0IHRva2VuIHRvIGxvY2FsIHN0b3JhZ2UgYW5kIHNldCBvbiB0aGUgaGVhZGVyc1xyXG4gICAgICAgIGp3dEludGVyY2VwdG9yUHJvdmlkZXIudG9rZW5HZXR0ZXIgPSBbJ2p3dEhlbHBlcicsICckaHR0cCcsICdzdG9yZScsICckc3RhdGUnLCAnJHJvb3RTY29wZScsIGZ1bmN0aW9uKGp3dEhlbHBlciwgJGh0dHAsIHN0b3JlLCAkc3RhdGUsICRyb290U2NvcGUpIHtcclxuICAgICAgICAgICAgdmFyIGlkVG9rZW4gPSBzdG9yZS5nZXQoJ2p3dCcpO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGp3dEhlbHBlci5pc1Rva2VuRXhwaXJlZChpZFRva2VuKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBwcm9taXNlIG9mIGEgSldUIGlkX3Rva2VuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS91c2Vycy9yZWZyZXNoJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBtYWtlcyBpdCBzbyB0aGF0IHRoaXMgcmVxdWVzdCBkb2Vzbid0IHNlbmQgdGhlIEpXVFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBza2lwQXV0aG9yaXphdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiBpZFRva2VuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZF90b2tlbiA9IHJlc3BvbnNlLmRhdGEudG9rZW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLnNldCgnand0JywgaWRfdG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRfdG9rZW47XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLnJlbW92ZSgnand0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc2lnbmluJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkVG9rZW47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUucmVtb3ZlKCdqd3QnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1dO1xyXG4gICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2p3dEludGVyY2VwdG9yJyk7XHJcblxyXG4gICAgICAgIC8vIEhvbWUgc3RhdGUgcm91dGluZ1xyXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnZGFzaGJvYXJkJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnLycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbWFpbi92aWV3cy9kYXNoYm9hcmQuY2xpZW50LnZpZXcuaHRtbCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XSk7IiwiYW5ndWxhci5tb2R1bGUoJ21haW4nKVxyXG4gICAgLmRpcmVjdGl2ZSgnbmdFbnRlcicsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgZWxlbWVudC5iaW5kKFwia2V5ZG93biBrZXlwcmVzc1wiLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAxMykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMubmdFbnRlciwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50JzogZXZlbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCJhbmd1bGFyLm1vZHVsZSgnb3JkZXInKVxyXG4gIC5jb25maWcoWyckc3RhdGVQcm92aWRlcicsIGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyKSB7XHJcblxyXG4gICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgLnN0YXRlKCdvcmRlclBhbmVsJywge1xyXG4gICAgICAgIHVybDogJy9vcmRlcnMnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9vcmRlci92aWV3cy9vcmRlci1wYW5lbC5jbGllbnQudmlldy5odG1sJyxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICByZXF1aXJlc0xvZ2luOiBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgfSkuc3RhdGUoJ2VkaXRvcmRlcicsIHtcclxuICAgICAgICB1cmw6ICcvb3JkZXJzLzppZC9lZGl0JyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvb3JkZXIvdmlld3MvZWRpdC1vcmRlci5jbGllbnQudmlldy5odG1sJyxcclxuICAgICAgfSkuc3RhdGUoJ29yZGVyRGV0YWlsJywge1xyXG4gICAgICAgIHVybDogJy9vcmRlcnMvOmlkJyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvb3JkZXIvdmlld3Mvb3JkZXItZGV0YWlsLmNsaWVudC52aWV3Lmh0bWwnXHJcbiAgICAgIH0pO1xyXG4gIH1dKTsiLCIvL0FydGljbGVzIHNlcnZpY2UgdXNlZCBmb3IgY29tbXVuaWNhdGluZyB3aXRoIHRoZSBhcnRpY2xlcyBSRVNUIGVuZHBvaW50c1xyXG5hbmd1bGFyLm1vZHVsZSgnb3JkZXInKS5mYWN0b3J5KCdPcmRlcnMnLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xyXG5cclxuXHR2YXIgYXBpID0gJHJlc291cmNlKCdhcGkvb3JkZXJzLzppZCcsIHtcclxuXHRcdGlkOiAnQF9pZCdcclxuXHR9LCB7XHJcblx0XHR1cGRhdGU6IHtcclxuXHRcdFx0bWV0aG9kOiAnUFVUJ1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHR2YXIgc2VhcmNoID0gJHJlc291cmNlKCdhcGkvb3JkZXJzLzppZC9zZWFyY2gvOm51bWJlci86bGFzdE5hbWUnLCB7XHJcblx0XHRpZDogJ0BfaWQnLFxyXG5cdFx0bnVtYmVyOiAnbnVtYmVyJyxcclxuXHRcdGxhc3ROYW1lOiAnbGFzdE5hbWUnXHJcblx0fSk7XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRhcGk6IGFwaSxcclxuXHRcdHNlYXJjaDogc2VhcmNoXHJcblx0fTtcclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCd1c2VyJylcclxuICAuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcikge1xyXG5cclxuICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgIC5zdGF0ZSgnc2lnbnVwJywge1xyXG4gICAgICAgIHVybDogJy9zaWdudXAnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy91c2VyL3ZpZXdzL3NpZ251cC5jbGllbnQudmlldy5odG1sJ1xyXG4gICAgICB9KS5zdGF0ZSgnc2lnbmluJywge1xyXG4gICAgICAgIHVybDogJy9zaWduaW4nLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy91c2VyL3ZpZXdzL3NpZ25pbi5jbGllbnQudmlldy5odG1sJyxcclxuICAgICAgfSkuc3RhdGUoJ3NlY3VyZXZpZXcnLCB7XHJcbiAgICAgICAgdXJsOiAnL3NlY3VyZXZpZXcnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy91c2VyL3ZpZXdzL3NlY3VyZXZpZXcuY2xpZW50LnZpZXcuaHRtbCcsXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgcmVxdWlyZXNMb2dpbjogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgfV0pXHJcbiAgLnJ1bihbJyRyb290U2NvcGUnLCAnJHdpbmRvdycsICdzdG9yZScsICdqd3RIZWxwZXInLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkd2luZG93LCBzdG9yZSwgand0SGVscGVyKSB7XHJcbiAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihlLCB0bykge1xyXG4gICAgICBpZiAodG8uZGF0YSAmJiB0by5kYXRhLnJlcXVpcmVzTG9naW4pIHtcclxuICAgICAgICBpZiAoIXN0b3JlLmdldCgnand0JykpIHtcclxuICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvc2lnbmluJztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1dKTsiLCJhbmd1bGFyLm1vZHVsZSgndXNlcicpXHJcbiAgLmNvbnRyb2xsZXIoJ1VzZXJDb250cm9sbGVyJywgWyckd2luZG93JywgJ1VzZXJzJywgJyRodHRwJywgJ3N0b3JlJywgJ2p3dEhlbHBlcicsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbigkd2luZG93LCBVc2VycywgJGh0dHAsIHN0b3JlLCBqd3RIZWxwZXIsICRzdGF0ZVBhcmFtcykge1xyXG5cclxuICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICB2bS51c2VyID0ge307XHJcbiAgICB2bS5lcnJvckluZm8gPSB7fTtcclxuXHJcbiAgICB2bS5zaWdudXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgLy8gJGh0dHAoe1xyXG4gICAgICAvLyAgIHVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvdXNlcnMvc2lnbnVwJyxcclxuICAgICAgLy8gICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgLy8gICBkYXRhOiB2bS51c2VyXHJcbiAgICAgIC8vIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgLy8gICBzdG9yZS5zZXQoJ2p3dCcsIHJlc3BvbnNlLmRhdGEudG9rZW4pO1xyXG4gICAgICAvLyAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvcGFuZWwnO1xyXG4gICAgICAvLyB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgLy8gICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAvLyAgIHZtLmVyck1lc3NhZ2UgPSBlcnIuZGF0YS5tZXNzYWdlO1xyXG4gICAgICAvLyB9KTtcclxuICAgICAgdmFyIG5ld1VzZXIgPSBuZXcgVXNlcnMuYXBpKHZtLnVzZXIpO1xyXG5cclxuICAgICAgbmV3VXNlci4kc2F2ZShmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgIHN0b3JlLnNldCgnand0JywgcmVzcG9uc2UudG9rZW4pO1xyXG4gICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvcGFuZWwnO1xyXG4gICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICB2bS5lcnJvckluZm8gPSBlcnI7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICB2bS5zaWduaW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgJGh0dHAoe1xyXG4gICAgICAgIHVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvdXNlcnMvc2lnbmluJyxcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBkYXRhOiB2bS51c2VyXHJcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICB2YXIgdG9rZW4gPSByZXNwb25zZS5kYXRhLnRva2VuO1xyXG4gICAgICAgIHN0b3JlLnNldCgnand0JywgdG9rZW4pO1xyXG4gICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvcGFuZWwnO1xyXG4gICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICB2bS5lcnJvckluZm8gPSBlcnIuZGF0YTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZtLmdldEFsbCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICBVc2Vycy5hcGkucXVlcnkoZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICB2bS51c2VycyA9IHJlc3BvbnNlLmZpbHRlcihmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICByZXR1cm4gZS5yb2xlID09PSAnVGVjaCc7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICB2bS5nZXRPbmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgVXNlcnMuYXBpLmdldCh7XHJcbiAgICAgICAgaWQ6ICRzdGF0ZVBhcmFtcy5pZFxyXG4gICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgIHZtLnVzZXIgPSByZXNwb25zZTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZtLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgdG9rZW4gPSBzdG9yZS5nZXQoJ2p3dCcpO1xyXG4gICAgICB2YXIgZGVjb2RlZCA9IGp3dEhlbHBlci5kZWNvZGVUb2tlbih0b2tlbik7XHJcbiAgICAgIFVzZXJzLmxvZ291dC5nZXQoe1xyXG4gICAgICAgIGlkOiBkZWNvZGVkLl9pZFxyXG4gICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICBzdG9yZS5yZW1vdmUoJ2p3dCcpO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfV0pO1xyXG5cclxuXHJcbmFuZ3VsYXIubW9kdWxlKCd1c2VyJylcclxuICAuZGlyZWN0aXZlKFwiY29tcGFyZVRvXCIsIFtmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHJlcXVpcmU6IFwibmdNb2RlbFwiLFxyXG4gICAgICBzY29wZToge1xyXG4gICAgICAgIG90aGVyTW9kZWxWYWx1ZTogXCI9Y29tcGFyZVRvXCJcclxuICAgICAgfSxcclxuICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0ZXMsIG5nTW9kZWwpIHtcclxuXHJcbiAgICAgICAgbmdNb2RlbC4kdmFsaWRhdG9ycy5jb21wYXJlVG8gPSBmdW5jdGlvbihtb2RlbFZhbHVlKSB7XHJcbiAgICAgICAgICByZXR1cm4gbW9kZWxWYWx1ZSA9PSBzY29wZS5vdGhlck1vZGVsVmFsdWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2NvcGUuJHdhdGNoKFwib3RoZXJNb2RlbFZhbHVlXCIsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgbmdNb2RlbC4kdmFsaWRhdGUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XSk7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgndXNlcicpXHJcbiAgLmRpcmVjdGl2ZSgncmVjb3JkQXZhaWxhYmlsaXR5VmFsaWRhdG9yJywgWyckaHR0cCcsICdVc2VycycsIGZ1bmN0aW9uKCRodHRwLCBVc2Vycykge1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7XHJcbiAgICAgICAgLy92YXIgYXBpVXJsID0gYXR0cnMucmVjb3JkQXZhaWxhYmlsaXR5VmFsaWRhdG9yO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRBc0xvYWRpbmcoYm9vbCkge1xyXG4gICAgICAgICAgbmdNb2RlbC4kc2V0VmFsaWRpdHkoJ3JlY29yZExvYWRpbmcnLCAhYm9vbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRBc0F2YWlsYWJsZShib29sKSB7XHJcbiAgICAgICAgICBuZ01vZGVsLiRzZXRWYWxpZGl0eSgncmVjb3JkQXZhaWxhYmxlJywgYm9vbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBuZ01vZGVsLiRwYXJzZXJzLnB1c2goZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgIGlmICghdmFsdWUgfHwgdmFsdWUubGVuZ3RoID09PSAwKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgc2V0QXNMb2FkaW5nKHRydWUpO1xyXG4gICAgICAgICAgc2V0QXNBdmFpbGFibGUoZmFsc2UpO1xyXG5cclxuICAgICAgICAgIC8vIHVzaW5nIHJlc291cmNlXHJcbiAgICAgICAgICB2YXIgZGF0YSA9IFVzZXJzLnNlYXJjaC5nZXQoe1xyXG4gICAgICAgICAgICBlbWFpbDogdmFsdWVcclxuICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoZGF0YS5kYXRhID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgc2V0QXNMb2FkaW5nKGZhbHNlKTtcclxuICAgICAgICAgICAgICBzZXRBc0F2YWlsYWJsZSh0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfV0pOyIsIi8vQXJ0aWNsZXMgc2VydmljZSB1c2VkIGZvciBjb21tdW5pY2F0aW5nIHdpdGggdGhlIGFydGljbGVzIFJFU1QgZW5kcG9pbnRzXHJcbmFuZ3VsYXIubW9kdWxlKCd1c2VyJykuZmFjdG9yeSgnVXNlcnMnLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xyXG5cclxuICAgIHZhciBhcGkgPSAkcmVzb3VyY2UoJ2FwaS91c2Vycy9zaWdudXAvOmlkJywge1xyXG4gICAgICAgIGlkOiAnQF9pZCdcclxuICAgIH0pO1xyXG5cclxuICAgIHZhciBsb2dvdXQgPSAkcmVzb3VyY2UoJ2FwaS91c2Vycy9sb2dvdXQvOmlkJywge1xyXG4gICAgICAgIGlkOiAnQF9pZCdcclxuICAgIH0pO1xyXG5cclxuICAgIHZhciBzZWFyY2ggPSAkcmVzb3VyY2UoJ2FwaS91c2Vycy9zZWFyY2gvOmVtYWlsJywge1xyXG4gICAgICAgIGVtYWlsOiAnQGVtYWlsJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBhcGk6IGFwaSxcclxuICAgICAgICBsb2dvdXQ6IGxvZ291dCxcclxuICAgICAgICBzZWFyY2g6IHNlYXJjaFxyXG4gICAgfTtcclxufVxyXG5dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
